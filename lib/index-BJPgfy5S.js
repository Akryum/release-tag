import{readFile as t,mkdir as e,rm as i,writeFile as s}from"node:fs/promises";import{existsSync as r,readdirSync as n,createWriteStream as h}from"node:fs";import{c as o,r as a,j as l,n as c,a as u,b as d,e as f}from"./index.js";import m from"events";import p from"stream";import y from"string_decoder";import b from"assert";import w from"buffer";import g from"zlib";import E from"path";import S from"fs";import _ from"process";import R from"util";import v from"crypto";import"node:module";import{pipeline as O}from"node:stream";import"node:child_process";import{homedir as T}from"node:os";import{promisify as k}from"node:util";import"os";import"http";import"https";import"net";import"tls";import"querystring";import"stream/web";import"node:events";import"worker_threads";import"perf_hooks";import"util/types";import"async_hooks";import"console";import"url";import"diagnostics_channel";import"child_process";import"timers";import"node:path";import"module";import"vm";import"v8";import"tty";import"node:url";import"node:assert";import"node:process";import"node:v8";var L,A,D={};function I(){if(A)return L;A=1;const t=new Map([["C","cwd"],["f","file"],["z","gzip"],["P","preservePaths"],["U","unlink"],["strip-components","strip"],["stripComponents","strip"],["keep-newer","newer"],["keepNewer","newer"],["keep-newer-files","newer"],["keepNewerFiles","newer"],["k","keep"],["keep-existing","keep"],["keepExisting","keep"],["m","noMtime"],["no-mtime","noMtime"],["p","preserveOwner"],["L","follow"],["h","follow"]]);return L=e=>e?Object.keys(e).map((i=>[t.has(i)?t.get(i):i,e[i]])).reduce(((t,e)=>(t[e[0]]=e[1],t)),Object.create(null)):{}}var x,N={};function B(){if(x)return N;x=1;const t="object"==typeof process&&process?process:{stdout:null,stderr:null},e=m,i=p,s=y.StringDecoder,r=Symbol("EOF"),n=Symbol("maybeEmitEnd"),h=Symbol("emittedEnd"),a=Symbol("emittingEnd"),l=Symbol("emittedError"),c=Symbol("closed"),u=Symbol("read"),d=Symbol("flush"),f=Symbol("flushChunk"),b=Symbol("encoding"),w=Symbol("decoder"),g=Symbol("flowing"),E=Symbol("paused"),S=Symbol("resume"),_=Symbol("buffer"),R=Symbol("pipes"),v=Symbol("bufferLength"),O=Symbol("bufferPush"),T=Symbol("bufferShift"),k=Symbol("objectMode"),L=Symbol("destroyed"),A=Symbol("error"),D=Symbol("emitData"),I=Symbol("emitEnd"),B=Symbol("emitEnd2"),M=Symbol("async"),C=Symbol("abort"),F=Symbol("aborted"),P=Symbol("signal"),z=t=>Promise.resolve().then(t),U="1"!==o._MP_NO_ITERATOR_SYMBOLS_,j=U&&Symbol.asyncIterator||Symbol("asyncIterator not implemented"),$=U&&Symbol.iterator||Symbol("iterator not implemented");class G{constructor(t,e,i){this.src=t,this.dest=e,this.opts=i,this.ondrain=()=>t[S](),e.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(){}end(){this.unpipe(),this.opts.end&&this.dest.end()}}class H extends G{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,i){super(t,e,i),this.proxyErrors=t=>e.emit("error",t),t.on("error",this.proxyErrors)}}class Z extends i{constructor(t){super(),this[g]=!1,this[E]=!1,this[R]=[],this[_]=[],this[k]=t&&t.objectMode||!1,this[k]?this[b]=null:this[b]=t&&t.encoding||null,"buffer"===this[b]&&(this[b]=null),this[M]=t&&!!t.async||!1,this[w]=this[b]?new s(this[b]):null,this[r]=!1,this[h]=!1,this[a]=!1,this[c]=!1,this[l]=null,this.writable=!0,this.readable=!0,this[v]=0,this[L]=!1,t&&!0===t.debugExposeBuffer&&Object.defineProperty(this,"buffer",{get:()=>this[_]}),t&&!0===t.debugExposePipes&&Object.defineProperty(this,"pipes",{get:()=>this[R]}),this[P]=t&&t.signal,this[F]=!1,this[P]&&(this[P].addEventListener("abort",(()=>this[C]())),this[P].aborted&&this[C]())}get bufferLength(){return this[v]}get encoding(){return this[b]}set encoding(t){if(this[k])throw new Error("cannot set encoding in objectMode");if(this[b]&&t!==this[b]&&(this[w]&&this[w].lastNeed||this[v]))throw new Error("cannot change encoding");this[b]!==t&&(this[w]=t?new s(t):null,this[_].length&&(this[_]=this[_].map((t=>this[w].write(t))))),this[b]=t}setEncoding(t){this.encoding=t}get objectMode(){return this[k]}set objectMode(t){this[k]=this[k]||!!t}get async(){return this[M]}set async(t){this[M]=this[M]||!!t}[C](){this[F]=!0,this.emit("abort",this[P].reason),this.destroy(this[P].reason)}get aborted(){return this[F]}set aborted(t){}write(t,e,i){if(this[F])return!1;if(this[r])throw new Error("write after end");if(this[L])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;"function"==typeof e&&(i=e,e="utf8"),e||(e="utf8");const s=this[M]?z:t=>t();var n;return this[k]||Buffer.isBuffer(t)||(n=t,!Buffer.isBuffer(n)&&ArrayBuffer.isView(n)?t=Buffer.from(t.buffer,t.byteOffset,t.byteLength):(t=>t instanceof ArrayBuffer||"object"==typeof t&&t.constructor&&"ArrayBuffer"===t.constructor.name&&t.byteLength>=0)(t)?t=Buffer.from(t):"string"!=typeof t&&(this.objectMode=!0)),this[k]?(this.flowing&&0!==this[v]&&this[d](!0),this.flowing?this.emit("data",t):this[O](t),0!==this[v]&&this.emit("readable"),i&&s(i),this.flowing):t.length?("string"!=typeof t||e===this[b]&&!this[w].lastNeed||(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[b]&&(t=this[w].write(t)),this.flowing&&0!==this[v]&&this[d](!0),this.flowing?this.emit("data",t):this[O](t),0!==this[v]&&this.emit("readable"),i&&s(i),this.flowing):(0!==this[v]&&this.emit("readable"),i&&s(i),this.flowing)}read(t){if(this[L])return null;if(0===this[v]||0===t||t>this[v])return this[n](),null;this[k]&&(t=null),this[_].length>1&&!this[k]&&(this.encoding?this[_]=[this[_].join("")]:this[_]=[Buffer.concat(this[_],this[v])]);const e=this[u](t||null,this[_][0]);return this[n](),e}[u](t,e){return t===e.length||null===t?this[T]():(this[_][0]=e.slice(t),e=e.slice(0,t),this[v]-=t),this.emit("data",e),this[_].length||this[r]||this.emit("drain"),e}end(t,e,i){return"function"==typeof t&&(i=t,t=null),"function"==typeof e&&(i=e,e="utf8"),t&&this.write(t,e),i&&this.once("end",i),this[r]=!0,this.writable=!1,!this.flowing&&this[E]||this[n](),this}[S](){this[L]||(this[E]=!1,this[g]=!0,this.emit("resume"),this[_].length?this[d]():this[r]?this[n]():this.emit("drain"))}resume(){return this[S]()}pause(){this[g]=!1,this[E]=!0}get destroyed(){return this[L]}get flowing(){return this[g]}get paused(){return this[E]}[O](t){this[k]?this[v]+=1:this[v]+=t.length,this[_].push(t)}[T](){return this[k]?this[v]-=1:this[v]-=this[_][0].length,this[_].shift()}[d](t){do{}while(this[f](this[T]())&&this[_].length);t||this[_].length||this[r]||this.emit("drain")}[f](t){return this.emit("data",t),this.flowing}pipe(e,i){if(this[L])return;const s=this[h];return i=i||{},e===t.stdout||e===t.stderr?i.end=!1:i.end=!1!==i.end,i.proxyErrors=!!i.proxyErrors,s?i.end&&e.end():(this[R].push(i.proxyErrors?new H(this,e,i):new G(this,e,i)),this[M]?z((()=>this[S]())):this[S]()),e}unpipe(t){const e=this[R].find((e=>e.dest===t));e&&(this[R].splice(this[R].indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){const i=super.on(t,e);return"data"!==t||this[R].length||this.flowing?"readable"===t&&0!==this[v]?super.emit("readable"):(t=>"end"===t||"finish"===t||"prefinish"===t)(t)&&this[h]?(super.emit(t),this.removeAllListeners(t)):"error"===t&&this[l]&&(this[M]?z((()=>e.call(this,this[l]))):e.call(this,this[l])):this[S](),i}get emittedEnd(){return this[h]}[n](){this[a]||this[h]||this[L]||0!==this[_].length||!this[r]||(this[a]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[c]&&this.emit("close"),this[a]=!1)}emit(t,e,...i){if("error"!==t&&"close"!==t&&t!==L&&this[L])return;if("data"===t)return!(!this[k]&&!e)&&(this[M]?z((()=>this[D](e))):this[D](e));if("end"===t)return this[I]();if("close"===t){if(this[c]=!0,!this[h]&&!this[L])return;const t=super.emit("close");return this.removeAllListeners("close"),t}if("error"===t){this[l]=e,super.emit(A,e);const t=!(this[P]&&!this.listeners("error").length)&&super.emit("error",e);return this[n](),t}if("resume"===t){const t=super.emit("resume");return this[n](),t}if("finish"===t||"prefinish"===t){const e=super.emit(t);return this.removeAllListeners(t),e}const s=super.emit(t,e,...i);return this[n](),s}[D](t){for(const e of this[R])!1===e.dest.write(t)&&this.pause();const e=super.emit("data",t);return this[n](),e}[I](){this[h]||(this[h]=!0,this.readable=!1,this[M]?z((()=>this[B]())):this[B]())}[B](){if(this[w]){const t=this[w].end();if(t){for(const e of this[R])e.dest.write(t);super.emit("data",t)}}for(const t of this[R])t.end();const t=super.emit("end");return this.removeAllListeners("end"),t}collect(){const t=[];this[k]||(t.dataLength=0);const e=this.promise();return this.on("data",(e=>{t.push(e),this[k]||(t.dataLength+=e.length)})),e.then((()=>t))}concat(){return this[k]?Promise.reject(new Error("cannot concat in objectMode")):this.collect().then((t=>this[k]?Promise.reject(new Error("cannot concat in objectMode")):this[b]?t.join(""):Buffer.concat(t,t.dataLength)))}promise(){return new Promise(((t,e)=>{this.on(L,(()=>e(new Error("stream destroyed")))),this.on("error",(t=>e(t))),this.on("end",(()=>t()))}))}[j](){let t=!1;const e=()=>(this.pause(),t=!0,Promise.resolve({done:!0}));return{next:()=>{if(t)return e();const i=this.read();if(null!==i)return Promise.resolve({done:!1,value:i});if(this[r])return e();let s=null,n=null;const h=t=>{this.removeListener("data",o),this.removeListener("end",a),this.removeListener(L,l),e(),n(t)},o=t=>{this.removeListener("error",h),this.removeListener("end",a),this.removeListener(L,l),this.pause(),s({value:t,done:!!this[r]})},a=()=>{this.removeListener("error",h),this.removeListener("data",o),this.removeListener(L,l),e(),s({done:!0})},l=()=>h(new Error("stream destroyed"));return new Promise(((t,e)=>{n=e,s=t,this.once(L,l),this.once("error",h),this.once("end",a),this.once("data",o)}))},throw:e,return:e,[j](){return this}}}[$](){let t=!1;const e=()=>(this.pause(),this.removeListener(A,e),this.removeListener(L,e),this.removeListener("end",e),t=!0,{done:!0});return this.once("end",e),this.once(A,e),this.once(L,e),{next:()=>{if(t)return e();const i=this.read();return null===i?e():{value:i}},throw:e,return:e,[$](){return this}}}destroy(t){return this[L]?(t?this.emit("error",t):this.emit(L),this):(this[L]=!0,this[_].length=0,this[v]=0,"function"!=typeof this.close||this[c]||this.close(),t?this.emit("error",t):this.emit(L),this)}static isStream(t){return!!t&&(t instanceof Z||t instanceof i||t instanceof e&&("function"==typeof t.pipe||"function"==typeof t.write&&"function"==typeof t.end))}}return N.Minipass=Z,N}var M,C,F,P,z,U,j,$,G,H={};function Z(){if(C)return M;C=1;const t=g.constants||{ZLIB_VERNUM:4736};return M=Object.freeze(Object.assign(Object.create(null),{Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_VERSION_ERROR:-6,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,DEFLATE:1,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:7,BROTLI_DECODE:8,BROTLI_ENCODE:9,Z_MIN_WINDOWBITS:8,Z_MAX_WINDOWBITS:15,Z_DEFAULT_WINDOWBITS:15,Z_MIN_CHUNK:64,Z_MAX_CHUNK:1/0,Z_DEFAULT_CHUNK:16384,Z_MIN_MEMLEVEL:1,Z_MAX_MEMLEVEL:9,Z_DEFAULT_MEMLEVEL:8,Z_MIN_LEVEL:-1,Z_MAX_LEVEL:9,Z_DEFAULT_LEVEL:-1,BROTLI_OPERATION_PROCESS:0,BROTLI_OPERATION_FLUSH:1,BROTLI_OPERATION_FINISH:2,BROTLI_OPERATION_EMIT_METADATA:3,BROTLI_MODE_GENERIC:0,BROTLI_MODE_TEXT:1,BROTLI_MODE_FONT:2,BROTLI_DEFAULT_MODE:0,BROTLI_MIN_QUALITY:0,BROTLI_MAX_QUALITY:11,BROTLI_DEFAULT_QUALITY:11,BROTLI_MIN_WINDOW_BITS:10,BROTLI_MAX_WINDOW_BITS:24,BROTLI_LARGE_MAX_WINDOW_BITS:30,BROTLI_DEFAULT_WINDOW:22,BROTLI_MIN_INPUT_BLOCK_BITS:16,BROTLI_MAX_INPUT_BLOCK_BITS:24,BROTLI_PARAM_MODE:0,BROTLI_PARAM_QUALITY:1,BROTLI_PARAM_LGWIN:2,BROTLI_PARAM_LGBLOCK:3,BROTLI_PARAM_DISABLE_LITERAL_CONTEXT_MODELING:4,BROTLI_PARAM_SIZE_HINT:5,BROTLI_PARAM_LARGE_WINDOW:6,BROTLI_PARAM_NPOSTFIX:7,BROTLI_PARAM_NDIRECT:8,BROTLI_DECODER_RESULT_ERROR:0,BROTLI_DECODER_RESULT_SUCCESS:1,BROTLI_DECODER_RESULT_NEEDS_MORE_INPUT:2,BROTLI_DECODER_RESULT_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_PARAM_DISABLE_RING_BUFFER_REALLOCATION:0,BROTLI_DECODER_PARAM_LARGE_WINDOW:1,BROTLI_DECODER_NO_ERROR:0,BROTLI_DECODER_SUCCESS:1,BROTLI_DECODER_NEEDS_MORE_INPUT:2,BROTLI_DECODER_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_NIBBLE:-1,BROTLI_DECODER_ERROR_FORMAT_RESERVED:-2,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_META_NIBBLE:-3,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_ALPHABET:-4,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_SAME:-5,BROTLI_DECODER_ERROR_FORMAT_CL_SPACE:-6,BROTLI_DECODER_ERROR_FORMAT_HUFFMAN_SPACE:-7,BROTLI_DECODER_ERROR_FORMAT_CONTEXT_MAP_REPEAT:-8,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_1:-9,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_2:-10,BROTLI_DECODER_ERROR_FORMAT_TRANSFORM:-11,BROTLI_DECODER_ERROR_FORMAT_DICTIONARY:-12,BROTLI_DECODER_ERROR_FORMAT_WINDOW_BITS:-13,BROTLI_DECODER_ERROR_FORMAT_PADDING_1:-14,BROTLI_DECODER_ERROR_FORMAT_PADDING_2:-15,BROTLI_DECODER_ERROR_FORMAT_DISTANCE:-16,BROTLI_DECODER_ERROR_DICTIONARY_NOT_SET:-19,BROTLI_DECODER_ERROR_INVALID_ARGUMENTS:-20,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MODES:-21,BROTLI_DECODER_ERROR_ALLOC_TREE_GROUPS:-22,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MAP:-25,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_1:-26,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_2:-27,BROTLI_DECODER_ERROR_ALLOC_BLOCK_TYPE_TREES:-30,BROTLI_DECODER_ERROR_UNREACHABLE:-31},t))}function W(){if(P)return F;P=1;const t="object"==typeof process&&process?process:{stdout:null,stderr:null},e=m,i=p,s=y.StringDecoder,r=Symbol("EOF"),n=Symbol("maybeEmitEnd"),h=Symbol("emittedEnd"),a=Symbol("emittingEnd"),l=Symbol("emittedError"),c=Symbol("closed"),u=Symbol("read"),d=Symbol("flush"),f=Symbol("flushChunk"),b=Symbol("encoding"),w=Symbol("decoder"),g=Symbol("flowing"),E=Symbol("paused"),S=Symbol("resume"),_=Symbol("bufferLength"),R=Symbol("bufferPush"),v=Symbol("bufferShift"),O=Symbol("objectMode"),T=Symbol("destroyed"),k=Symbol("emitData"),L=Symbol("emitEnd"),A=Symbol("emitEnd2"),D=Symbol("async"),I=t=>Promise.resolve().then(t),x="1"!==o._MP_NO_ITERATOR_SYMBOLS_,N=x&&Symbol.asyncIterator||Symbol("asyncIterator not implemented"),B=x&&Symbol.iterator||Symbol("iterator not implemented");class M{constructor(t,e,i){this.src=t,this.dest=e,this.opts=i,this.ondrain=()=>t[S](),e.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(){}end(){this.unpipe(),this.opts.end&&this.dest.end()}}class C extends M{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,i){super(t,e,i),this.proxyErrors=t=>e.emit("error",t),t.on("error",this.proxyErrors)}}return F=class o extends i{constructor(t){super(),this[g]=!1,this[E]=!1,this.pipes=[],this.buffer=[],this[O]=t&&t.objectMode||!1,this[O]?this[b]=null:this[b]=t&&t.encoding||null,"buffer"===this[b]&&(this[b]=null),this[D]=t&&!!t.async||!1,this[w]=this[b]?new s(this[b]):null,this[r]=!1,this[h]=!1,this[a]=!1,this[c]=!1,this[l]=null,this.writable=!0,this.readable=!0,this[_]=0,this[T]=!1}get bufferLength(){return this[_]}get encoding(){return this[b]}set encoding(t){if(this[O])throw new Error("cannot set encoding in objectMode");if(this[b]&&t!==this[b]&&(this[w]&&this[w].lastNeed||this[_]))throw new Error("cannot change encoding");this[b]!==t&&(this[w]=t?new s(t):null,this.buffer.length&&(this.buffer=this.buffer.map((t=>this[w].write(t))))),this[b]=t}setEncoding(t){this.encoding=t}get objectMode(){return this[O]}set objectMode(t){this[O]=this[O]||!!t}get async(){return this[D]}set async(t){this[D]=this[D]||!!t}write(t,e,i){if(this[r])throw new Error("write after end");if(this[T])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;"function"==typeof e&&(i=e,e="utf8"),e||(e="utf8");const s=this[D]?I:t=>t();var n;return this[O]||Buffer.isBuffer(t)||(n=t,!Buffer.isBuffer(n)&&ArrayBuffer.isView(n)?t=Buffer.from(t.buffer,t.byteOffset,t.byteLength):(t=>t instanceof ArrayBuffer||"object"==typeof t&&t.constructor&&"ArrayBuffer"===t.constructor.name&&t.byteLength>=0)(t)?t=Buffer.from(t):"string"!=typeof t&&(this.objectMode=!0)),this[O]?(this.flowing&&0!==this[_]&&this[d](!0),this.flowing?this.emit("data",t):this[R](t),0!==this[_]&&this.emit("readable"),i&&s(i),this.flowing):t.length?("string"!=typeof t||e===this[b]&&!this[w].lastNeed||(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[b]&&(t=this[w].write(t)),this.flowing&&0!==this[_]&&this[d](!0),this.flowing?this.emit("data",t):this[R](t),0!==this[_]&&this.emit("readable"),i&&s(i),this.flowing):(0!==this[_]&&this.emit("readable"),i&&s(i),this.flowing)}read(t){if(this[T])return null;if(0===this[_]||0===t||t>this[_])return this[n](),null;this[O]&&(t=null),this.buffer.length>1&&!this[O]&&(this.encoding?this.buffer=[this.buffer.join("")]:this.buffer=[Buffer.concat(this.buffer,this[_])]);const e=this[u](t||null,this.buffer[0]);return this[n](),e}[u](t,e){return t===e.length||null===t?this[v]():(this.buffer[0]=e.slice(t),e=e.slice(0,t),this[_]-=t),this.emit("data",e),this.buffer.length||this[r]||this.emit("drain"),e}end(t,e,i){return"function"==typeof t&&(i=t,t=null),"function"==typeof e&&(i=e,e="utf8"),t&&this.write(t,e),i&&this.once("end",i),this[r]=!0,this.writable=!1,!this.flowing&&this[E]||this[n](),this}[S](){this[T]||(this[E]=!1,this[g]=!0,this.emit("resume"),this.buffer.length?this[d]():this[r]?this[n]():this.emit("drain"))}resume(){return this[S]()}pause(){this[g]=!1,this[E]=!0}get destroyed(){return this[T]}get flowing(){return this[g]}get paused(){return this[E]}[R](t){this[O]?this[_]+=1:this[_]+=t.length,this.buffer.push(t)}[v](){return this.buffer.length&&(this[O]?this[_]-=1:this[_]-=this.buffer[0].length),this.buffer.shift()}[d](t){do{}while(this[f](this[v]()));t||this.buffer.length||this[r]||this.emit("drain")}[f](t){return!!t&&(this.emit("data",t),this.flowing)}pipe(e,i){if(this[T])return;const s=this[h];return i=i||{},e===t.stdout||e===t.stderr?i.end=!1:i.end=!1!==i.end,i.proxyErrors=!!i.proxyErrors,s?i.end&&e.end():(this.pipes.push(i.proxyErrors?new C(this,e,i):new M(this,e,i)),this[D]?I((()=>this[S]())):this[S]()),e}unpipe(t){const e=this.pipes.find((e=>e.dest===t));e&&(this.pipes.splice(this.pipes.indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){const i=super.on(t,e);return"data"!==t||this.pipes.length||this.flowing?"readable"===t&&0!==this[_]?super.emit("readable"):(t=>"end"===t||"finish"===t||"prefinish"===t)(t)&&this[h]?(super.emit(t),this.removeAllListeners(t)):"error"===t&&this[l]&&(this[D]?I((()=>e.call(this,this[l]))):e.call(this,this[l])):this[S](),i}get emittedEnd(){return this[h]}[n](){this[a]||this[h]||this[T]||0!==this.buffer.length||!this[r]||(this[a]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[c]&&this.emit("close"),this[a]=!1)}emit(t,e,...i){if("error"!==t&&"close"!==t&&t!==T&&this[T])return;if("data"===t)return!!e&&(this[D]?I((()=>this[k](e))):this[k](e));if("end"===t)return this[L]();if("close"===t){if(this[c]=!0,!this[h]&&!this[T])return;const t=super.emit("close");return this.removeAllListeners("close"),t}if("error"===t){this[l]=e;const t=super.emit("error",e);return this[n](),t}if("resume"===t){const t=super.emit("resume");return this[n](),t}if("finish"===t||"prefinish"===t){const e=super.emit(t);return this.removeAllListeners(t),e}const s=super.emit(t,e,...i);return this[n](),s}[k](t){for(const e of this.pipes)!1===e.dest.write(t)&&this.pause();const e=super.emit("data",t);return this[n](),e}[L](){this[h]||(this[h]=!0,this.readable=!1,this[D]?I((()=>this[A]())):this[A]())}[A](){if(this[w]){const t=this[w].end();if(t){for(const e of this.pipes)e.dest.write(t);super.emit("data",t)}}for(const t of this.pipes)t.end();const t=super.emit("end");return this.removeAllListeners("end"),t}collect(){const t=[];this[O]||(t.dataLength=0);const e=this.promise();return this.on("data",(e=>{t.push(e),this[O]||(t.dataLength+=e.length)})),e.then((()=>t))}concat(){return this[O]?Promise.reject(new Error("cannot concat in objectMode")):this.collect().then((t=>this[O]?Promise.reject(new Error("cannot concat in objectMode")):this[b]?t.join(""):Buffer.concat(t,t.dataLength)))}promise(){return new Promise(((t,e)=>{this.on(T,(()=>e(new Error("stream destroyed")))),this.on("error",(t=>e(t))),this.on("end",(()=>t()))}))}[N](){return{next:()=>{const t=this.read();if(null!==t)return Promise.resolve({done:!1,value:t});if(this[r])return Promise.resolve({done:!0});let e=null,i=null;const s=t=>{this.removeListener("data",n),this.removeListener("end",h),i(t)},n=t=>{this.removeListener("error",s),this.removeListener("end",h),this.pause(),e({value:t,done:!!this[r]})},h=()=>{this.removeListener("error",s),this.removeListener("data",n),e({done:!0})},o=()=>s(new Error("stream destroyed"));return new Promise(((t,r)=>{i=r,e=t,this.once(T,o),this.once("error",s),this.once("end",h),this.once("data",n)}))}}}[B](){return{next:()=>{const t=this.read();return{value:t,done:null===t}}}}destroy(t){return this[T]?(t?this.emit("error",t):this.emit(T),this):(this[T]=!0,this.buffer.length=0,this[_]=0,"function"!=typeof this.close||this[c]||this.close(),t?this.emit("error",t):this.emit(T),this)}static isStream(t){return!!t&&(t instanceof o||t instanceof i||t instanceof e&&("function"==typeof t.pipe||"function"==typeof t.write&&"function"==typeof t.end))}},F}function V(){if(z)return H;z=1;const t=b,e=w.Buffer,i=g,s=H.constants=Z(),r=W(),n=e.concat,h=Symbol("_superWrite");class o extends Error{constructor(t){super("zlib: "+t.message),this.code=t.code,this.errno=t.errno,this.code||(this.code="ZLIB_ERROR"),this.message="zlib: "+t.message,Error.captureStackTrace(this,this.constructor)}get name(){return"ZlibError"}}const a=Symbol("opts"),l=Symbol("flushFlag"),c=Symbol("finishFlushFlag"),u=Symbol("fullFlushFlag"),d=Symbol("handle"),f=Symbol("onError"),m=Symbol("sawError"),p=Symbol("level"),y=Symbol("strategy"),E=Symbol("ended");class S extends r{constructor(t,e){if(!t||"object"!=typeof t)throw new TypeError("invalid options for ZlibBase constructor");super(t),this[m]=!1,this[E]=!1,this[a]=t,this[l]=t.flush,this[c]=t.finishFlush;try{this[d]=new i[e](t)}catch(t){throw new o(t)}this[f]=t=>{this[m]||(this[m]=!0,this.close(),this.emit("error",t))},this[d].on("error",(t=>this[f](new o(t)))),this.once("end",(()=>this.close))}close(){this[d]&&(this[d].close(),this[d]=null,this.emit("close"))}reset(){if(!this[m])return t(this[d],"zlib binding closed"),this[d].reset()}flush(t){this.ended||("number"!=typeof t&&(t=this[u]),this.write(Object.assign(e.alloc(0),{[l]:t})))}end(t,e,i){return t&&this.write(t,e),this.flush(this[c]),this[E]=!0,super.end(null,null,i)}get ended(){return this[E]}write(i,s,r){if("function"==typeof s&&(r=s,s="utf8"),"string"==typeof i&&(i=e.from(i,s)),this[m])return;t(this[d],"zlib binding closed");const a=this[d]._handle,c=a.close;a.close=()=>{};const u=this[d].close;let p,y;this[d].close=()=>{},e.concat=t=>t;try{const t="number"==typeof i[l]?i[l]:this[l];p=this[d]._processChunk(i,t),e.concat=n}catch(t){e.concat=n,this[f](new o(t))}finally{this[d]&&(this[d]._handle=a,a.close=c,this[d].close=u,this[d].removeAllListeners("error"))}if(this[d]&&this[d].on("error",(t=>this[f](new o(t)))),p)if(Array.isArray(p)&&p.length>0){y=this[h](e.from(p[0]));for(let t=1;t<p.length;t++)y=this[h](p[t])}else y=this[h](e.from(p));return r&&r(),y}[h](t){return super.write(t)}}class _ extends S{constructor(t,e){(t=t||{}).flush=t.flush||s.Z_NO_FLUSH,t.finishFlush=t.finishFlush||s.Z_FINISH,super(t,e),this[u]=s.Z_FULL_FLUSH,this[p]=t.level,this[y]=t.strategy}params(e,i){if(!this[m]){if(!this[d])throw new Error("cannot switch params when binding is closed");if(!this[d].params)throw new Error("not supported in this implementation");if(this[p]!==e||this[y]!==i){this.flush(s.Z_SYNC_FLUSH),t(this[d],"zlib binding closed");const r=this[d].flush;this[d].flush=(t,e)=>{this.flush(t),e()};try{this[d].params(e,i)}finally{this[d].flush=r}this[d]&&(this[p]=e,this[y]=i)}}}}const R=Symbol("_portable");class v extends S{constructor(t,e){(t=t||{}).flush=t.flush||s.BROTLI_OPERATION_PROCESS,t.finishFlush=t.finishFlush||s.BROTLI_OPERATION_FINISH,super(t,e),this[u]=s.BROTLI_OPERATION_FLUSH}}class O extends v{constructor(t){super(t,"BrotliCompress")}}class T extends v{constructor(t){super(t,"BrotliDecompress")}}return H.Deflate=class extends _{constructor(t){super(t,"Deflate")}},H.Inflate=class extends _{constructor(t){super(t,"Inflate")}},H.Gzip=class extends _{constructor(t){super(t,"Gzip"),this[R]=t&&!!t.portable}[h](t){return this[R]?(this[R]=!1,t[9]=255,super[h](t)):super[h](t)}},H.Gunzip=class extends _{constructor(t){super(t,"Gunzip")}},H.DeflateRaw=class extends _{constructor(t){super(t,"DeflateRaw")}},H.InflateRaw=class extends _{constructor(t){super(t,"InflateRaw")}},H.Unzip=class extends _{constructor(t){super(t,"Unzip")}},"function"==typeof i.BrotliCompress?(H.BrotliCompress=O,H.BrotliDecompress=T):H.BrotliCompress=H.BrotliDecompress=class{constructor(){throw new Error("Brotli is not supported in this version of Node.js")}},H}function Y(){if(j)return U;j=1;const t=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform;return U="win32"!==t?t=>t:t=>t&&t.replace(/\\/g,"/")}function X(){if(G)return $;G=1;const{Minipass:t}=B(),e=Y(),i=Symbol("slurp");return $=class extends t{constructor(t,s,r){switch(super(),this.pause(),this.extended=s,this.globalExtended=r,this.header=t,this.startBlockSize=512*Math.ceil(t.size/512),this.blockRemain=this.startBlockSize,this.remain=t.size,this.type=t.type,this.meta=!1,this.ignore=!1,this.type){case"File":case"OldFile":case"Link":case"SymbolicLink":case"CharacterDevice":case"BlockDevice":case"Directory":case"FIFO":case"ContiguousFile":case"GNUDumpDir":break;case"NextFileHasLongLinkpath":case"NextFileHasLongPath":case"OldGnuLongPath":case"GlobalExtendedHeader":case"ExtendedHeader":case"OldExtendedHeader":this.meta=!0;break;default:this.ignore=!0}this.path=e(t.path),this.mode=t.mode,this.mode&&(this.mode=4095&this.mode),this.uid=t.uid,this.gid=t.gid,this.uname=t.uname,this.gname=t.gname,this.size=t.size,this.mtime=t.mtime,this.atime=t.atime,this.ctime=t.ctime,this.linkpath=e(t.linkpath),this.uname=t.uname,this.gname=t.gname,s&&this[i](s),r&&this[i](r,!0)}write(t){const e=t.length;if(e>this.blockRemain)throw new Error("writing more to entry than is appropriate");const i=this.remain,s=this.blockRemain;return this.remain=Math.max(0,i-e),this.blockRemain=Math.max(0,s-e),!!this.ignore||(i>=e?super.write(t):super.write(t.slice(0,i)))}[i](t,i){for(const s in t)null===t[s]||void 0===t[s]||i&&"path"===s||(this[s]="path"===s||"linkpath"===s?e(t[s]):t[s])}},$}var K,q,J,Q,tt,et,it,st,rt,nt,ht,ot,at,lt,ct,ut,dt,ft,mt,pt,yt,bt,wt,gt,Et,St={};function _t(){return K||(K=1,(t=St).name=new Map([["0","File"],["","OldFile"],["1","Link"],["2","SymbolicLink"],["3","CharacterDevice"],["4","BlockDevice"],["5","Directory"],["6","FIFO"],["7","ContiguousFile"],["g","GlobalExtendedHeader"],["x","ExtendedHeader"],["A","SolarisACL"],["D","GNUDumpDir"],["I","Inode"],["K","NextFileHasLongLinkpath"],["L","NextFileHasLongPath"],["M","ContinuationFile"],["N","OldGnuLongPath"],["S","SparseFile"],["V","TapeVolumeHeader"],["X","OldExtendedHeader"]]),t.code=new Map(Array.from(t.name).map((t=>[t[1],t[0]])))),St;var t}function Rt(){if(tt)return Q;tt=1;const t=_t(),e=E.posix,i=function(){if(J)return q;J=1;const t=(t,e)=>{e[0]=128;for(var i=e.length;i>1;i--)e[i-1]=255&t,t=Math.floor(t/256)},e=(t,e)=>{e[0]=255;var i=!1;t*=-1;for(var s=e.length;s>1;s--){var h=255&t;t=Math.floor(t/256),i?e[s-1]=r(h):0===h?e[s-1]=0:(i=!0,e[s-1]=n(h))}},i=t=>{for(var e=t.length,i=0,s=!1,h=e-1;h>-1;h--){var o,a=t[h];s?o=r(a):0===a?o=a:(s=!0,o=n(a)),0!==o&&(i-=o*Math.pow(256,e-h-1))}return i},s=t=>{for(var e=t.length,i=0,s=e-1;s>-1;s--){var r=t[s];0!==r&&(i+=r*Math.pow(256,e-s-1))}return i},r=t=>255&(255^t),n=t=>1+(255^t)&255;return q={encode:(i,s)=>{if(!Number.isSafeInteger(i))throw Error("cannot encode number outside of javascript safe integer range");return i<0?e(i,s):t(i,s),s},parse:t=>{const e=t[0],r=128===e?s(t.slice(1,t.length)):255===e?i(t):null;if(null===r)throw Error("invalid base256 encoding");if(!Number.isSafeInteger(r))throw Error("parsed number outside of javascript safe integer range");return r}}}(),s=Symbol("slurp"),r=Symbol("type");const n=(t,i)=>{const s=100;let r,n=t,h="";const o=e.parse(t).root||".";if(Buffer.byteLength(n)<s)r=[n,h,!1];else{h=e.dirname(n),n=e.basename(n);do{Buffer.byteLength(n)<=s&&Buffer.byteLength(h)<=i?r=[n,h,!1]:Buffer.byteLength(n)>s&&Buffer.byteLength(h)<=i?r=[n.slice(0,99),h,!0]:(n=e.join(e.basename(h),n),h=e.dirname(h))}while(h!==o&&!r);r||(r=[t.slice(0,99),"",!0])}return r},h=(t,e,i)=>t.slice(e,e+i).toString("utf8").replace(/\0.*/,""),o=(t,e,i)=>a(l(t,e,i)),a=t=>null===t?null:new Date(1e3*t),l=(t,e,s)=>128&t[e]?i.parse(t.slice(e,e+s)):c(t,e,s),c=(t,e,i)=>{return s=parseInt(t.slice(e,e+i).toString("utf8").replace(/\0.*$/,"").trim(),8),isNaN(s)?null:s;var s},u={12:8589934591,8:2097151},d=(t,e,s,r)=>null!==r&&(r>u[s]||r<0?(i.encode(r,t.slice(e,e+s)),!0):(f(t,e,s,r),!1)),f=(t,e,i,s)=>t.write(m(s,i),e,i,"ascii"),m=(t,e)=>p(Math.floor(t).toString(8),e),p=(t,e)=>(t.length===e-1?t:new Array(e-t.length-1).join("0")+t+" ")+"\0",y=(t,e,i,s)=>null!==s&&d(t,e,i,s.getTime()/1e3),b=new Array(156).join("\0"),w=(t,e,i,s)=>null!==s&&(t.write(s+b,e,i,"utf8"),s.length!==Buffer.byteLength(s)||s.length>i);return Q=class{constructor(t,e,i,s){this.cksumValid=!1,this.needPax=!1,this.nullBlock=!1,this.block=null,this.path=null,this.mode=null,this.uid=null,this.gid=null,this.size=null,this.mtime=null,this.cksum=null,this[r]="0",this.linkpath=null,this.uname=null,this.gname=null,this.devmaj=0,this.devmin=0,this.atime=null,this.ctime=null,Buffer.isBuffer(t)?this.decode(t,e||0,i,s):t&&this.set(t)}decode(t,e,i,n){if(e||(e=0),!(t&&t.length>=e+512))throw new Error("need 512 bytes for header");if(this.path=h(t,e,100),this.mode=l(t,e+100,8),this.uid=l(t,e+108,8),this.gid=l(t,e+116,8),this.size=l(t,e+124,12),this.mtime=o(t,e+136,12),this.cksum=l(t,e+148,12),this[s](i),this[s](n,!0),this[r]=h(t,e+156,1),""===this[r]&&(this[r]="0"),"0"===this[r]&&"/"===this.path.slice(-1)&&(this[r]="5"),"5"===this[r]&&(this.size=0),this.linkpath=h(t,e+157,100),"ustar\x0000"===t.slice(e+257,e+265).toString())if(this.uname=h(t,e+265,32),this.gname=h(t,e+297,32),this.devmaj=l(t,e+329,8),this.devmin=l(t,e+337,8),0!==t[e+475]){const i=h(t,e+345,155);this.path=i+"/"+this.path}else{const i=h(t,e+345,130);i&&(this.path=i+"/"+this.path),this.atime=o(t,e+476,12),this.ctime=o(t,e+488,12)}let a=256;for(let i=e;i<e+148;i++)a+=t[i];for(let i=e+156;i<e+512;i++)a+=t[i];this.cksumValid=a===this.cksum,null===this.cksum&&256===a&&(this.nullBlock=!0)}[s](t,e){for(const i in t)null===t[i]||void 0===t[i]||e&&"path"===i||(this[i]=t[i])}encode(t,e){if(t||(t=this.block=Buffer.alloc(512),e=0),e||(e=0),!(t.length>=e+512))throw new Error("need 512 bytes for header");const i=this.ctime||this.atime?130:155,s=n(this.path||"",i),h=s[0],o=s[1];this.needPax=s[2],this.needPax=w(t,e,100,h)||this.needPax,this.needPax=d(t,e+100,8,this.mode)||this.needPax,this.needPax=d(t,e+108,8,this.uid)||this.needPax,this.needPax=d(t,e+116,8,this.gid)||this.needPax,this.needPax=d(t,e+124,12,this.size)||this.needPax,this.needPax=y(t,e+136,12,this.mtime)||this.needPax,t[e+156]=this[r].charCodeAt(0),this.needPax=w(t,e+157,100,this.linkpath)||this.needPax,t.write("ustar\x0000",e+257,8),this.needPax=w(t,e+265,32,this.uname)||this.needPax,this.needPax=w(t,e+297,32,this.gname)||this.needPax,this.needPax=d(t,e+329,8,this.devmaj)||this.needPax,this.needPax=d(t,e+337,8,this.devmin)||this.needPax,this.needPax=w(t,e+345,i,o)||this.needPax,0!==t[e+475]?this.needPax=w(t,e+345,155,o)||this.needPax:(this.needPax=w(t,e+345,130,o)||this.needPax,this.needPax=y(t,e+476,12,this.atime)||this.needPax,this.needPax=y(t,e+488,12,this.ctime)||this.needPax);let a=256;for(let i=e;i<e+148;i++)a+=t[i];for(let i=e+156;i<e+512;i++)a+=t[i];return this.cksum=a,d(t,e+148,8,this.cksum),this.cksumValid=!0,this.needPax}set(t){for(const e in t)null!==t[e]&&void 0!==t[e]&&(this[e]=t[e])}get type(){return t.name.get(this[r])||this[r]}get typeKey(){return this[r]}set type(e){t.code.has(e)?this[r]=t.code.get(e):this[r]=e}},Q}function vt(){if(it)return et;it=1;const t=Rt(),e=E;class i{constructor(t,e){this.atime=t.atime||null,this.charset=t.charset||null,this.comment=t.comment||null,this.ctime=t.ctime||null,this.gid=t.gid||null,this.gname=t.gname||null,this.linkpath=t.linkpath||null,this.mtime=t.mtime||null,this.path=t.path||null,this.size=t.size||null,this.uid=t.uid||null,this.uname=t.uname||null,this.dev=t.dev||null,this.ino=t.ino||null,this.nlink=t.nlink||null,this.global=e||!1}encode(){const i=this.encodeBody();if(""===i)return null;const s=Buffer.byteLength(i),r=512*Math.ceil(1+s/512),n=Buffer.allocUnsafe(r);for(let t=0;t<512;t++)n[t]=0;new t({path:("PaxHeader/"+e.basename(this.path)).slice(0,99),mode:this.mode||420,uid:this.uid||null,gid:this.gid||null,size:s,mtime:this.mtime||null,type:this.global?"GlobalExtendedHeader":"ExtendedHeader",linkpath:"",uname:this.uname||"",gname:this.gname||"",devmaj:0,devmin:0,atime:this.atime||null,ctime:this.ctime||null}).encode(n),n.write(i,512,s,"utf8");for(let t=s+512;t<n.length;t++)n[t]=0;return n}encodeBody(){return this.encodeField("path")+this.encodeField("ctime")+this.encodeField("atime")+this.encodeField("dev")+this.encodeField("ino")+this.encodeField("nlink")+this.encodeField("charset")+this.encodeField("comment")+this.encodeField("gid")+this.encodeField("gname")+this.encodeField("linkpath")+this.encodeField("mtime")+this.encodeField("size")+this.encodeField("uid")+this.encodeField("uname")}encodeField(t){if(null===this[t]||void 0===this[t])return"";const e=" "+("dev"===t||"ino"===t||"nlink"===t?"SCHILY.":"")+t+"="+(this[t]instanceof Date?this[t].getTime()/1e3:this[t])+"\n",i=Buffer.byteLength(e);let s=Math.floor(Math.log(i)/Math.log(10))+1;i+s>=Math.pow(10,s)&&(s+=1);return s+i+e}}i.parse=(t,e,n)=>new i(s(r(t),e),n);const s=(t,e)=>e?Object.keys(t).reduce(((e,i)=>(e[i]=t[i],e)),e):t,r=t=>t.replace(/\n$/,"").split("\n").reduce(n,Object.create(null)),n=(t,e)=>{const i=parseInt(e,10);if(i!==Buffer.byteLength(e)+1)return t;const s=(e=e.slice((i+" ").length)).split("="),r=s.shift().replace(/^SCHILY\.(dev|ino|nlink)/,"$1");if(!r)return t;const n=s.join("=");return t[r]=/^([A-Z]+\.)?([mac]|birth|creation)time$/.test(r)?new Date(1e3*n):/^[0-9]+$/.test(n)?+n:n,t};return et=i}function Ot(){return rt||(rt=1,st=t=>{let e=t.length-1,i=-1;for(;e>-1&&"/"===t.charAt(e);)i=e,e--;return-1===i?t:t.slice(0,i)}),st}function Tt(){return ht?nt:(ht=1,nt=t=>class extends t{warn(t,e,i={}){this.file&&(i.file=this.file),this.cwd&&(i.cwd=this.cwd),i.code=e instanceof Error&&e.code||t,i.tarCode=t,this.strict||!1===i.recoverable?e instanceof Error?this.emit("error",Object.assign(e,i)):this.emit("error",Object.assign(new Error(`${t}: ${e}`),i)):(e instanceof Error&&(i=Object.assign(e,i),e=e.message),this.emit("warn",i.tarCode,e,i))}})}function kt(){if(at)return ot;at=1;const t=["|","<",">","?",":"],e=t.map((t=>String.fromCharCode(61440+t.charCodeAt(0)))),i=new Map(t.map(((t,i)=>[t,e[i]]))),s=new Map(e.map(((e,i)=>[e,t[i]])));return ot={encode:e=>t.reduce(((t,e)=>t.split(e).join(i.get(e))),e),decode:t=>e.reduce(((t,e)=>t.split(e).join(s.get(e))),t)},ot}function Lt(){if(ct)return lt;ct=1;const{isAbsolute:t,parse:e}=E.win32;return lt=i=>{let s="",r=e(i);for(;t(i)||r.root;){const t="/"===i.charAt(0)&&"//?/"!==i.slice(0,4)?"/":r.root;i=i.slice(t.length),s+=t,r=e(i)}return[s,i]}}function At(){return dt?ut:(dt=1,ut=(t,e,i)=>(t&=4095,i&&(t=-19&t|384),e&&(256&t&&(t|=64),32&t&&(t|=8),4&t&&(t|=1)),t))}function Dt(){if(mt)return ft;mt=1;const{Minipass:t}=B(),e=vt(),i=Rt(),s=S,r=E,n=Y(),h=Ot(),o=(t,e)=>e?(t=n(t).replace(/^\.(\/|$)/,""),h(e)+"/"+t):n(t),a=Symbol("process"),l=Symbol("file"),c=Symbol("directory"),u=Symbol("symlink"),d=Symbol("hardlink"),f=Symbol("header"),m=Symbol("read"),p=Symbol("lstat"),y=Symbol("onlstat"),b=Symbol("onread"),w=Symbol("onreadlink"),g=Symbol("openfile"),_=Symbol("onopenfile"),R=Symbol("close"),v=Symbol("mode"),O=Symbol("awaitDrain"),T=Symbol("ondrain"),k=Symbol("prefix"),L=Symbol("hadError"),A=Tt(),D=kt(),I=Lt(),x=At(),N=A(class extends t{constructor(t,e){if(super(e=e||{}),"string"!=typeof t)throw new TypeError("path is required");this.path=n(t),this.portable=!!e.portable,this.myuid=process.getuid&&process.getuid()||0,this.myuser=process.env.USER||"",this.maxReadSize=e.maxReadSize||16777216,this.linkCache=e.linkCache||new Map,this.statCache=e.statCache||new Map,this.preservePaths=!!e.preservePaths,this.cwd=n(e.cwd||process.cwd()),this.strict=!!e.strict,this.noPax=!!e.noPax,this.noMtime=!!e.noMtime,this.mtime=e.mtime||null,this.prefix=e.prefix?n(e.prefix):null,this.fd=null,this.blockLen=null,this.blockRemain=null,this.buf=null,this.offset=null,this.length=null,this.pos=null,this.remain=null,"function"==typeof e.onwarn&&this.on("warn",e.onwarn);let i=!1;if(!this.preservePaths){const[t,e]=I(this.path);t&&(this.path=e,i=t)}this.win32=!!e.win32||"win32"===process.platform,this.win32&&(this.path=D.decode(this.path.replace(/\\/g,"/")),t=t.replace(/\\/g,"/")),this.absolute=n(e.absolute||r.resolve(this.cwd,t)),""===this.path&&(this.path="./"),i&&this.warn("TAR_ENTRY_INFO",`stripping ${i} from absolute path`,{entry:this,path:i+this.path}),this.statCache.has(this.absolute)?this[y](this.statCache.get(this.absolute)):this[p]()}emit(t,...e){return"error"===t&&(this[L]=!0),super.emit(t,...e)}[p](){s.lstat(this.absolute,((t,e)=>{if(t)return this.emit("error",t);this[y](e)}))}[y](t){this.statCache.set(this.absolute,t),this.stat=t,t.isFile()||(t.size=0),this.type=C(t),this.emit("stat",t),this[a]()}[a](){switch(this.type){case"File":return this[l]();case"Directory":return this[c]();case"SymbolicLink":return this[u]();default:return this.end()}}[v](t){return x(t,"Directory"===this.type,this.portable)}[k](t){return o(t,this.prefix)}[f](){"Directory"===this.type&&this.portable&&(this.noMtime=!0),this.header=new i({path:this[k](this.path),linkpath:"Link"===this.type?this[k](this.linkpath):this.linkpath,mode:this[v](this.stat.mode),uid:this.portable?null:this.stat.uid,gid:this.portable?null:this.stat.gid,size:this.stat.size,mtime:this.noMtime?null:this.mtime||this.stat.mtime,type:this.type,uname:this.portable?null:this.stat.uid===this.myuid?this.myuser:"",atime:this.portable?null:this.stat.atime,ctime:this.portable?null:this.stat.ctime}),this.header.encode()&&!this.noPax&&super.write(new e({atime:this.portable?null:this.header.atime,ctime:this.portable?null:this.header.ctime,gid:this.portable?null:this.header.gid,mtime:this.noMtime?null:this.mtime||this.header.mtime,path:this[k](this.path),linkpath:"Link"===this.type?this[k](this.linkpath):this.linkpath,size:this.header.size,uid:this.portable?null:this.header.uid,uname:this.portable?null:this.header.uname,dev:this.portable?null:this.stat.dev,ino:this.portable?null:this.stat.ino,nlink:this.portable?null:this.stat.nlink}).encode()),super.write(this.header.block)}[c](){"/"!==this.path.slice(-1)&&(this.path+="/"),this.stat.size=0,this[f](),this.end()}[u](){s.readlink(this.absolute,((t,e)=>{if(t)return this.emit("error",t);this[w](e)}))}[w](t){this.linkpath=n(t),this[f](),this.end()}[d](t){this.type="Link",this.linkpath=n(r.relative(this.cwd,t)),this.stat.size=0,this[f](),this.end()}[l](){if(this.stat.nlink>1){const t=this.stat.dev+":"+this.stat.ino;if(this.linkCache.has(t)){const e=this.linkCache.get(t);if(0===e.indexOf(this.cwd))return this[d](e)}this.linkCache.set(t,this.absolute)}if(this[f](),0===this.stat.size)return this.end();this[g]()}[g](){s.open(this.absolute,"r",((t,e)=>{if(t)return this.emit("error",t);this[_](e)}))}[_](t){if(this.fd=t,this[L])return this[R]();this.blockLen=512*Math.ceil(this.stat.size/512),this.blockRemain=this.blockLen;const e=Math.min(this.blockLen,this.maxReadSize);this.buf=Buffer.allocUnsafe(e),this.offset=0,this.pos=0,this.remain=this.stat.size,this.length=this.buf.length,this[m]()}[m](){const{fd:t,buf:e,offset:i,length:r,pos:n}=this;s.read(t,e,i,r,n,((t,e)=>{if(t)return this[R]((()=>this.emit("error",t)));this[b](e)}))}[R](t){s.close(this.fd,t)}[b](t){if(t<=0&&this.remain>0){const t=new Error("encountered unexpected EOF");return t.path=this.absolute,t.syscall="read",t.code="EOF",this[R]((()=>this.emit("error",t)))}if(t>this.remain){const t=new Error("did not encounter expected EOF");return t.path=this.absolute,t.syscall="read",t.code="EOF",this[R]((()=>this.emit("error",t)))}if(t===this.remain)for(let e=t;e<this.length&&t<this.blockRemain;e++)this.buf[e+this.offset]=0,t++,this.remain++;const e=0===this.offset&&t===this.buf.length?this.buf:this.buf.slice(this.offset,this.offset+t);this.write(e)?this[T]():this[O]((()=>this[T]()))}[O](t){this.once("drain",t)}write(t){if(this.blockRemain<t.length){const t=new Error("writing more data than expected");return t.path=this.absolute,this.emit("error",t)}return this.remain-=t.length,this.blockRemain-=t.length,this.pos+=t.length,this.offset+=t.length,super.write(t)}[T](){if(!this.remain)return this.blockRemain&&super.write(Buffer.alloc(this.blockRemain)),this[R]((t=>t?this.emit("error",t):this.end()));this.offset>=this.length&&(this.buf=Buffer.allocUnsafe(Math.min(this.blockRemain,this.buf.length)),this.offset=0),this.length=this.buf.length-this.offset,this[m]()}});const M=A(class extends t{constructor(t,s){super(s=s||{}),this.preservePaths=!!s.preservePaths,this.portable=!!s.portable,this.strict=!!s.strict,this.noPax=!!s.noPax,this.noMtime=!!s.noMtime,this.readEntry=t,this.type=t.type,"Directory"===this.type&&this.portable&&(this.noMtime=!0),this.prefix=s.prefix||null,this.path=n(t.path),this.mode=this[v](t.mode),this.uid=this.portable?null:t.uid,this.gid=this.portable?null:t.gid,this.uname=this.portable?null:t.uname,this.gname=this.portable?null:t.gname,this.size=t.size,this.mtime=this.noMtime?null:s.mtime||t.mtime,this.atime=this.portable?null:t.atime,this.ctime=this.portable?null:t.ctime,this.linkpath=n(t.linkpath),"function"==typeof s.onwarn&&this.on("warn",s.onwarn);let r=!1;if(!this.preservePaths){const[t,e]=I(this.path);t&&(this.path=e,r=t)}this.remain=t.size,this.blockRemain=t.startBlockSize,this.header=new i({path:this[k](this.path),linkpath:"Link"===this.type?this[k](this.linkpath):this.linkpath,mode:this.mode,uid:this.portable?null:this.uid,gid:this.portable?null:this.gid,size:this.size,mtime:this.noMtime?null:this.mtime,type:this.type,uname:this.portable?null:this.uname,atime:this.portable?null:this.atime,ctime:this.portable?null:this.ctime}),r&&this.warn("TAR_ENTRY_INFO",`stripping ${r} from absolute path`,{entry:this,path:r+this.path}),this.header.encode()&&!this.noPax&&super.write(new e({atime:this.portable?null:this.atime,ctime:this.portable?null:this.ctime,gid:this.portable?null:this.gid,mtime:this.noMtime?null:this.mtime,path:this[k](this.path),linkpath:"Link"===this.type?this[k](this.linkpath):this.linkpath,size:this.size,uid:this.portable?null:this.uid,uname:this.portable?null:this.uname,dev:this.portable?null:this.readEntry.dev,ino:this.portable?null:this.readEntry.ino,nlink:this.portable?null:this.readEntry.nlink}).encode()),super.write(this.header.block),t.pipe(this)}[k](t){return o(t,this.prefix)}[v](t){return x(t,"Directory"===this.type,this.portable)}write(t){const e=t.length;if(e>this.blockRemain)throw new Error("writing more to entry than is appropriate");return this.blockRemain-=e,super.write(t)}end(){return this.blockRemain&&super.write(Buffer.alloc(this.blockRemain)),super.end()}});N.Sync=class extends N{[p](){this[y](s.lstatSync(this.absolute))}[u](){this[w](s.readlinkSync(this.absolute))}[g](){this[_](s.openSync(this.absolute,"r"))}[m](){let t=!0;try{const{fd:e,buf:i,offset:r,length:n,pos:h}=this,o=s.readSync(e,i,r,n,h);this[b](o),t=!1}finally{if(t)try{this[R]((()=>{}))}catch(t){}}}[O](t){t()}[R](t){s.closeSync(this.fd),t()}},N.Tar=M;const C=t=>t.isFile()?"File":t.isDirectory()?"Directory":t.isSymbolicLink()?"SymbolicLink":"Unsupported";return ft=N}function It(){if(wt)return bt;function t(e){var i=this;if(i instanceof t||(i=new t),i.tail=null,i.head=null,i.length=0,e&&"function"==typeof e.forEach)e.forEach((function(t){i.push(t)}));else if(arguments.length>0)for(var s=0,r=arguments.length;s<r;s++)i.push(arguments[s]);return i}function e(t,e,i){var s=e===t.head?new r(i,null,e,t):new r(i,e,e.next,t);return null===s.next&&(t.tail=s),null===s.prev&&(t.head=s),t.length++,s}function i(t,e){t.tail=new r(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function s(t,e){t.head=new r(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function r(t,e,i,s){if(!(this instanceof r))return new r(t,e,i,s);this.list=s,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,i?(i.prev=this,this.next=i):this.next=null}wt=1,bt=t,t.Node=r,t.create=t,t.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,i=t.prev;return e&&(e.prev=i),i&&(i.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=i),t.list.length--,t.next=null,t.prev=null,t.list=null,e},t.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}},t.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}},t.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)i(this,arguments[t]);return this.length},t.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)s(this,arguments[t]);return this.length},t.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}},t.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}},t.prototype.forEach=function(t,e){e=e||this;for(var i=this.head,s=0;null!==i;s++)t.call(e,i.value,s,this),i=i.next},t.prototype.forEachReverse=function(t,e){e=e||this;for(var i=this.tail,s=this.length-1;null!==i;s--)t.call(e,i.value,s,this),i=i.prev},t.prototype.get=function(t){for(var e=0,i=this.head;null!==i&&e<t;e++)i=i.next;if(e===t&&null!==i)return i.value},t.prototype.getReverse=function(t){for(var e=0,i=this.tail;null!==i&&e<t;e++)i=i.prev;if(e===t&&null!==i)return i.value},t.prototype.map=function(e,i){i=i||this;for(var s=new t,r=this.head;null!==r;)s.push(e.call(i,r.value,this)),r=r.next;return s},t.prototype.mapReverse=function(e,i){i=i||this;for(var s=new t,r=this.tail;null!==r;)s.push(e.call(i,r.value,this)),r=r.prev;return s},t.prototype.reduce=function(t,e){var i,s=this.head;if(arguments.length>1)i=e;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");s=this.head.next,i=this.head.value}for(var r=0;null!==s;r++)i=t(i,s.value,r),s=s.next;return i},t.prototype.reduceReverse=function(t,e){var i,s=this.tail;if(arguments.length>1)i=e;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");s=this.tail.prev,i=this.tail.value}for(var r=this.length-1;null!==s;r--)i=t(i,s.value,r),s=s.prev;return i},t.prototype.toArray=function(){for(var t=new Array(this.length),e=0,i=this.head;null!==i;e++)t[e]=i.value,i=i.next;return t},t.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,i=this.tail;null!==i;e++)t[e]=i.value,i=i.prev;return t},t.prototype.slice=function(e,i){(i=i||this.length)<0&&(i+=this.length),(e=e||0)<0&&(e+=this.length);var s=new t;if(i<e||i<0)return s;e<0&&(e=0),i>this.length&&(i=this.length);for(var r=0,n=this.head;null!==n&&r<e;r++)n=n.next;for(;null!==n&&r<i;r++,n=n.next)s.push(n.value);return s},t.prototype.sliceReverse=function(e,i){(i=i||this.length)<0&&(i+=this.length),(e=e||0)<0&&(e+=this.length);var s=new t;if(i<e||i<0)return s;e<0&&(e=0),i>this.length&&(i=this.length);for(var r=this.length,n=this.tail;null!==n&&r>i;r--)n=n.prev;for(;null!==n&&r>e;r--,n=n.prev)s.push(n.value);return s},t.prototype.splice=function(t,i,...s){t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);for(var r=0,n=this.head;null!==n&&r<t;r++)n=n.next;var h=[];for(r=0;n&&r<i;r++)h.push(n.value),n=this.removeNode(n);null===n&&(n=this.tail),n!==this.head&&n!==this.tail&&(n=n.prev);for(r=0;r<s.length;r++)n=e(this,n,s[r]);return h},t.prototype.reverse=function(){for(var t=this.head,e=this.tail,i=t;null!==i;i=i.prev){var s=i.prev;i.prev=i.next,i.next=s}return this.head=e,this.tail=t,this};try{(yt?pt:(yt=1,pt=function(t){t.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}))(t)}catch(t){}return bt}function xt(){if(Et)return gt;Et=1;class t{constructor(t,e){this.path=t||"./",this.absolute=e,this.entry=null,this.stat=null,this.readdir=null,this.pending=!1,this.ignore=!1,this.piped=!1}}const{Minipass:e}=B(),i=V(),s=X(),r=Dt(),n=r.Sync,h=r.Tar,o=It(),a=Buffer.alloc(1024),l=Symbol("onStat"),c=Symbol("ended"),u=Symbol("queue"),d=Symbol("current"),f=Symbol("process"),m=Symbol("processing"),p=Symbol("processJob"),y=Symbol("jobs"),b=Symbol("jobDone"),w=Symbol("addFSEntry"),g=Symbol("addTarEntry"),_=Symbol("stat"),R=Symbol("readdir"),v=Symbol("onreaddir"),O=Symbol("pipe"),T=Symbol("entry"),k=Symbol("entryOpt"),L=Symbol("writeEntryClass"),A=Symbol("write"),D=Symbol("ondrain"),I=S,x=E,N=Tt(),M=Y(),C=N(class extends e{constructor(t){if(super(t),t=t||Object.create(null),this.opt=t,this.file=t.file||"",this.cwd=t.cwd||process.cwd(),this.maxReadSize=t.maxReadSize,this.preservePaths=!!t.preservePaths,this.strict=!!t.strict,this.noPax=!!t.noPax,this.prefix=M(t.prefix||""),this.linkCache=t.linkCache||new Map,this.statCache=t.statCache||new Map,this.readdirCache=t.readdirCache||new Map,this[L]=r,"function"==typeof t.onwarn&&this.on("warn",t.onwarn),this.portable=!!t.portable,this.zip=null,t.gzip||t.brotli){if(t.gzip&&t.brotli)throw new TypeError("gzip and brotli are mutually exclusive");t.gzip&&("object"!=typeof t.gzip&&(t.gzip={}),this.portable&&(t.gzip.portable=!0),this.zip=new i.Gzip(t.gzip)),t.brotli&&("object"!=typeof t.brotli&&(t.brotli={}),this.zip=new i.BrotliCompress(t.brotli)),this.zip.on("data",(t=>super.write(t))),this.zip.on("end",(t=>super.end())),this.zip.on("drain",(t=>this[D]())),this.on("resume",(t=>this.zip.resume()))}else this.on("drain",this[D]);this.noDirRecurse=!!t.noDirRecurse,this.follow=!!t.follow,this.noMtime=!!t.noMtime,this.mtime=t.mtime||null,this.filter="function"==typeof t.filter?t.filter:t=>!0,this[u]=new o,this[y]=0,this.jobs=+t.jobs||4,this[m]=!1,this[c]=!1}[A](t){return super.write(t)}add(t){return this.write(t),this}end(t){return t&&this.write(t),this[c]=!0,this[f](),this}write(t){if(this[c])throw new Error("write after end");return t instanceof s?this[g](t):this[w](t),this.flowing}[g](e){const i=M(x.resolve(this.cwd,e.path));if(this.filter(e.path,e)){const s=new t(e.path,i,!1);s.entry=new h(e,this[k](s)),s.entry.on("end",(t=>this[b](s))),this[y]+=1,this[u].push(s)}else e.resume();this[f]()}[w](e){const i=M(x.resolve(this.cwd,e));this[u].push(new t(e,i)),this[f]()}[_](t){t.pending=!0,this[y]+=1;const e=this.follow?"stat":"lstat";I[e](t.absolute,((e,i)=>{t.pending=!1,this[y]-=1,e?this.emit("error",e):this[l](t,i)}))}[l](t,e){this.statCache.set(t.absolute,e),t.stat=e,this.filter(t.path,e)||(t.ignore=!0),this[f]()}[R](t){t.pending=!0,this[y]+=1,I.readdir(t.absolute,((e,i)=>{if(t.pending=!1,this[y]-=1,e)return this.emit("error",e);this[v](t,i)}))}[v](t,e){this.readdirCache.set(t.absolute,e),t.readdir=e,this[f]()}[f](){if(!this[m]){this[m]=!0;for(let t=this[u].head;null!==t&&this[y]<this.jobs;t=t.next)if(this[p](t.value),t.value.ignore){const e=t.next;this[u].removeNode(t),t.next=e}this[m]=!1,this[c]&&!this[u].length&&0===this[y]&&(this.zip?this.zip.end(a):(super.write(a),super.end()))}}get[d](){return this[u]&&this[u].head&&this[u].head.value}[b](t){this[u].shift(),this[y]-=1,this[f]()}[p](t){t.pending||(t.entry?t!==this[d]||t.piped||this[O](t):(t.stat||(this.statCache.has(t.absolute)?this[l](t,this.statCache.get(t.absolute)):this[_](t)),t.stat&&(t.ignore||(this.noDirRecurse||!t.stat.isDirectory()||t.readdir||(this.readdirCache.has(t.absolute)?this[v](t,this.readdirCache.get(t.absolute)):this[R](t),t.readdir))&&(t.entry=this[T](t),t.entry?t!==this[d]||t.piped||this[O](t):t.ignore=!0))))}[k](t){return{onwarn:(t,e,i)=>this.warn(t,e,i),noPax:this.noPax,cwd:this.cwd,absolute:t.absolute,preservePaths:this.preservePaths,maxReadSize:this.maxReadSize,strict:this.strict,portable:this.portable,linkCache:this.linkCache,statCache:this.statCache,noMtime:this.noMtime,mtime:this.mtime,prefix:this.prefix}}[T](t){this[y]+=1;try{return new this[L](t.path,this[k](t)).on("end",(()=>this[b](t))).on("error",(t=>this.emit("error",t)))}catch(t){this.emit("error",t)}}[D](){this[d]&&this[d].entry&&this[d].entry.resume()}[O](t){t.piped=!0,t.readdir&&t.readdir.forEach((e=>{const i=t.path,s="./"===i?"":i.replace(/\/*$/,"/");this[w](s+e)}));const e=t.entry,i=this.zip;i?e.on("data",(t=>{i.write(t)||e.pause()})):e.on("data",(t=>{super.write(t)||e.pause()}))}pause(){return this.zip&&this.zip.pause(),super.pause()}});return C.Sync=class extends C{constructor(t){super(t),this[L]=n}pause(){}resume(){}[_](t){const e=this.follow?"statSync":"lstatSync";this[l](t,I[e](t.absolute))}[R](t,e){this[v](t,I.readdirSync(t.absolute))}[O](t){const e=t.entry,i=this.zip;t.readdir&&t.readdir.forEach((e=>{const i=t.path,s="./"===i?"":i.replace(/\/*$/,"/");this[w](s+e)})),i?e.on("data",(t=>{i.write(t)})):e.on("data",(t=>{super[A](t)}))}},gt=C}var Nt,Bt,Mt,Ct,Ft,Pt,zt,Ut,jt,$t,Gt,Ht={};function Zt(){if(Nt)return Ht;Nt=1;const t=W(),e=m.EventEmitter,i=S;let s=i.writev;if(!s){const t=process.binding("fs"),e=t.FSReqWrap||t.FSReqCallback;s=(i,s,r,n)=>{const h=new e;h.oncomplete=(t,e)=>n(t,e,s),t.writeBuffers(i,s,r,h)}}const r=Symbol("_autoClose"),n=Symbol("_close"),h=Symbol("_ended"),o=Symbol("_fd"),a=Symbol("_finished"),l=Symbol("_flags"),c=Symbol("_flush"),u=Symbol("_handleChunk"),d=Symbol("_makeBuf"),f=Symbol("_mode"),p=Symbol("_needDrain"),y=Symbol("_onerror"),b=Symbol("_onopen"),w=Symbol("_onread"),g=Symbol("_onwrite"),E=Symbol("_open"),_=Symbol("_path"),R=Symbol("_pos"),v=Symbol("_queue"),O=Symbol("_read"),T=Symbol("_readSize"),k=Symbol("_reading"),L=Symbol("_remain"),A=Symbol("_size"),D=Symbol("_write"),I=Symbol("_writing"),x=Symbol("_defaultFlag"),N=Symbol("_errored");class B extends t{constructor(t,e){if(super(e=e||{}),this.readable=!0,this.writable=!1,"string"!=typeof t)throw new TypeError("path must be a string");this[N]=!1,this[o]="number"==typeof e.fd?e.fd:null,this[_]=t,this[T]=e.readSize||16777216,this[k]=!1,this[A]="number"==typeof e.size?e.size:1/0,this[L]=this[A],this[r]="boolean"!=typeof e.autoClose||e.autoClose,"number"==typeof this[o]?this[O]():this[E]()}get fd(){return this[o]}get path(){return this[_]}write(){throw new TypeError("this is a readable stream")}end(){throw new TypeError("this is a readable stream")}[E](){i.open(this[_],"r",((t,e)=>this[b](t,e)))}[b](t,e){t?this[y](t):(this[o]=e,this.emit("open",e),this[O]())}[d](){return Buffer.allocUnsafe(Math.min(this[T],this[L]))}[O](){if(!this[k]){this[k]=!0;const t=this[d]();if(0===t.length)return process.nextTick((()=>this[w](null,0,t)));i.read(this[o],t,0,t.length,null,((t,e,i)=>this[w](t,e,i)))}}[w](t,e,i){this[k]=!1,t?this[y](t):this[u](e,i)&&this[O]()}[n](){if(this[r]&&"number"==typeof this[o]){const t=this[o];this[o]=null,i.close(t,(t=>t?this.emit("error",t):this.emit("close")))}}[y](t){this[k]=!0,this[n](),this.emit("error",t)}[u](t,e){let i=!1;return this[L]-=t,t>0&&(i=super.write(t<e.length?e.slice(0,t):e)),(0===t||this[L]<=0)&&(i=!1,this[n](),super.end()),i}emit(t,e){switch(t){case"prefinish":case"finish":break;case"drain":"number"==typeof this[o]&&this[O]();break;case"error":if(this[N])return;return this[N]=!0,super.emit(t,e);default:return super.emit(t,e)}}}class M extends e{constructor(t,e){super(e=e||{}),this.readable=!1,this.writable=!0,this[N]=!1,this[I]=!1,this[h]=!1,this[p]=!1,this[v]=[],this[_]=t,this[o]="number"==typeof e.fd?e.fd:null,this[f]=void 0===e.mode?438:e.mode,this[R]="number"==typeof e.start?e.start:null,this[r]="boolean"!=typeof e.autoClose||e.autoClose;const i=null!==this[R]?"r+":"w";this[x]=void 0===e.flags,this[l]=this[x]?i:e.flags,null===this[o]&&this[E]()}emit(t,e){if("error"===t){if(this[N])return;this[N]=!0}return super.emit(t,e)}get fd(){return this[o]}get path(){return this[_]}[y](t){this[n](),this[I]=!0,this.emit("error",t)}[E](){i.open(this[_],this[l],this[f],((t,e)=>this[b](t,e)))}[b](t,e){this[x]&&"r+"===this[l]&&t&&"ENOENT"===t.code?(this[l]="w",this[E]()):t?this[y](t):(this[o]=e,this.emit("open",e),this[c]())}end(t,e){return t&&this.write(t,e),this[h]=!0,this[I]||this[v].length||"number"!=typeof this[o]||this[g](null,0),this}write(t,e){return"string"==typeof t&&(t=Buffer.from(t,e)),this[h]?(this.emit("error",new Error("write() after end()")),!1):null===this[o]||this[I]||this[v].length?(this[v].push(t),this[p]=!0,!1):(this[I]=!0,this[D](t),!0)}[D](t){i.write(this[o],t,0,t.length,this[R],((t,e)=>this[g](t,e)))}[g](t,e){t?this[y](t):(null!==this[R]&&(this[R]+=e),this[v].length?this[c]():(this[I]=!1,this[h]&&!this[a]?(this[a]=!0,this[n](),this.emit("finish")):this[p]&&(this[p]=!1,this.emit("drain"))))}[c](){if(0===this[v].length)this[h]&&this[g](null,0);else if(1===this[v].length)this[D](this[v].pop());else{const t=this[v];this[v]=[],s(this[o],t,this[R],((t,e)=>this[g](t,e)))}}[n](){if(this[r]&&"number"==typeof this[o]){const t=this[o];this[o]=null,i.close(t,(t=>t?this.emit("error",t):this.emit("close")))}}}return Ht.ReadStream=B,Ht.ReadStreamSync=class extends B{[E](){let t=!0;try{this[b](null,i.openSync(this[_],"r")),t=!1}finally{t&&this[n]()}}[O](){let t=!0;try{if(!this[k]){for(this[k]=!0;;){const t=this[d](),e=0===t.length?0:i.readSync(this[o],t,0,t.length,null);if(!this[u](e,t))break}this[k]=!1}t=!1}finally{t&&this[n]()}}[n](){if(this[r]&&"number"==typeof this[o]){const t=this[o];this[o]=null,i.closeSync(t),this.emit("close")}}},Ht.WriteStream=M,Ht.WriteStreamSync=class extends M{[E](){let t;if(this[x]&&"r+"===this[l])try{t=i.openSync(this[_],this[l],this[f])}catch(t){if("ENOENT"===t.code)return this[l]="w",this[E]();throw t}else t=i.openSync(this[_],this[l],this[f]);this[b](null,t)}[n](){if(this[r]&&"number"==typeof this[o]){const t=this[o];this[o]=null,i.closeSync(t),this.emit("close")}}[D](t){let e=!0;try{this[g](null,i.writeSync(this[o],t,0,t.length,this[R])),e=!1}finally{if(e)try{this[n]()}catch(t){}}}},Ht}function Wt(){if(Mt)return Bt;Mt=1;const t=Tt(),e=Rt(),i=m,s=It(),r=X(),n=vt(),h=V(),{nextTick:o}=_,a=Buffer.from([31,139]),l=Symbol("state"),c=Symbol("writeEntry"),u=Symbol("readEntry"),d=Symbol("nextEntry"),f=Symbol("processEntry"),p=Symbol("extendedHeader"),y=Symbol("globalExtendedHeader"),b=Symbol("meta"),w=Symbol("emitMeta"),g=Symbol("buffer"),E=Symbol("queue"),S=Symbol("ended"),R=Symbol("emittedEnd"),v=Symbol("emit"),O=Symbol("unzip"),T=Symbol("consumeChunk"),k=Symbol("consumeChunkSub"),L=Symbol("consumeBody"),A=Symbol("consumeMeta"),D=Symbol("consumeHeader"),I=Symbol("consuming"),x=Symbol("bufferConcat"),N=Symbol("maybeEnd"),B=Symbol("writing"),M=Symbol("aborted"),C=Symbol("onDone"),F=Symbol("sawValidEntry"),P=Symbol("sawNullBlock"),z=Symbol("sawEOF"),U=Symbol("closeStream"),j=t=>!0;return Bt=t(class extends i{constructor(t){super(t=t||{}),this.file=t.file||"",this[F]=null,this.on(C,(t=>{"begin"!==this[l]&&!1!==this[F]||this.warn("TAR_BAD_ARCHIVE","Unrecognized archive format")})),t.ondone?this.on(C,t.ondone):this.on(C,(t=>{this.emit("prefinish"),this.emit("finish"),this.emit("end")})),this.strict=!!t.strict,this.maxMetaEntrySize=t.maxMetaEntrySize||1048576,this.filter="function"==typeof t.filter?t.filter:j;const e=t.file&&(t.file.endsWith(".tar.br")||t.file.endsWith(".tbr"));this.brotli=t.gzip||void 0===t.brotli?!!e&&void 0:t.brotli,this.writable=!0,this.readable=!1,this[E]=new s,this[g]=null,this[u]=null,this[c]=null,this[l]="begin",this[b]="",this[p]=null,this[y]=null,this[S]=!1,this[O]=null,this[M]=!1,this[P]=!1,this[z]=!1,this.on("end",(()=>this[U]())),"function"==typeof t.onwarn&&this.on("warn",t.onwarn),"function"==typeof t.onentry&&this.on("entry",t.onentry)}[D](t,i){let s;null===this[F]&&(this[F]=!1);try{s=new e(t,i,this[p],this[y])}catch(t){return this.warn("TAR_ENTRY_INVALID",t)}if(s.nullBlock)this[P]?(this[z]=!0,"begin"===this[l]&&(this[l]="header"),this[v]("eof")):(this[P]=!0,this[v]("nullBlock"));else if(this[P]=!1,s.cksumValid)if(s.path){const t=s.type;if(/^(Symbolic)?Link$/.test(t)&&!s.linkpath)this.warn("TAR_ENTRY_INVALID","linkpath required",{header:s});else if(!/^(Symbolic)?Link$/.test(t)&&s.linkpath)this.warn("TAR_ENTRY_INVALID","linkpath forbidden",{header:s});else{const t=this[c]=new r(s,this[p],this[y]);if(!this[F])if(t.remain){const e=()=>{t.invalid||(this[F]=!0)};t.on("end",e)}else this[F]=!0;t.meta?t.size>this.maxMetaEntrySize?(t.ignore=!0,this[v]("ignoredEntry",t),this[l]="ignore",t.resume()):t.size>0&&(this[b]="",t.on("data",(t=>this[b]+=t)),this[l]="meta"):(this[p]=null,t.ignore=t.ignore||!this.filter(t.path,t),t.ignore?(this[v]("ignoredEntry",t),this[l]=t.remain?"ignore":"header",t.resume()):(t.remain?this[l]="body":(this[l]="header",t.end()),this[u]?this[E].push(t):(this[E].push(t),this[d]())))}}else this.warn("TAR_ENTRY_INVALID","path is required",{header:s});else this.warn("TAR_ENTRY_INVALID","checksum failure",{header:s})}[U](){o((()=>this.emit("close")))}[f](t){let e=!0;return t?Array.isArray(t)?this.emit.apply(this,t):(this[u]=t,this.emit("entry",t),t.emittedEnd||(t.on("end",(t=>this[d]())),e=!1)):(this[u]=null,e=!1),e}[d](){do{}while(this[f](this[E].shift()));if(!this[E].length){const t=this[u];!t||t.flowing||t.size===t.remain?this[B]||this.emit("drain"):t.once("drain",(t=>this.emit("drain")))}}[L](t,e){const i=this[c],s=i.blockRemain,r=s>=t.length&&0===e?t:t.slice(e,e+s);return i.write(r),i.blockRemain||(this[l]="header",this[c]=null,i.end()),r.length}[A](t,e){const i=this[c],s=this[L](t,e);return this[c]||this[w](i),s}[v](t,e,i){this[E].length||this[u]?this[E].push([t,e,i]):this.emit(t,e,i)}[w](t){switch(this[v]("meta",this[b]),t.type){case"ExtendedHeader":case"OldExtendedHeader":this[p]=n.parse(this[b],this[p],!1);break;case"GlobalExtendedHeader":this[y]=n.parse(this[b],this[y],!0);break;case"NextFileHasLongPath":case"OldGnuLongPath":this[p]=this[p]||Object.create(null),this[p].path=this[b].replace(/\0.*/,"");break;case"NextFileHasLongLinkpath":this[p]=this[p]||Object.create(null),this[p].linkpath=this[b].replace(/\0.*/,"");break;default:throw new Error("unknown meta: "+t.type)}}abort(t){this[M]=!0,this.emit("abort",t),this.warn("TAR_ABORT",t,{recoverable:!1})}write(t){if(this[M])return;if((null===this[O]||void 0===this.brotli&&!1===this[O])&&t){if(this[g]&&(t=Buffer.concat([this[g],t]),this[g]=null),t.length<a.length)return this[g]=t,!0;for(let e=0;null===this[O]&&e<a.length;e++)t[e]!==a[e]&&(this[O]=!1);const i=void 0===this.brotli;if(!1===this[O]&&i)if(t.length<512){if(!this[S])return this[g]=t,!0;this.brotli=!0}else try{new e(t.slice(0,512)),this.brotli=!1}catch(t){this.brotli=!0}if(null===this[O]||!1===this[O]&&this.brotli){const e=this[S];this[S]=!1,this[O]=null===this[O]?new h.Unzip:new h.BrotliDecompress,this[O].on("data",(t=>this[T](t))),this[O].on("error",(t=>this.abort(t))),this[O].on("end",(t=>{this[S]=!0,this[T]()})),this[B]=!0;const i=this[O][e?"end":"write"](t);return this[B]=!1,i}}this[B]=!0,this[O]?this[O].write(t):this[T](t),this[B]=!1;const i=!this[E].length&&(!this[u]||this[u].flowing);return i||this[E].length||this[u].once("drain",(t=>this.emit("drain"))),i}[x](t){t&&!this[M]&&(this[g]=this[g]?Buffer.concat([this[g],t]):t)}[N](){if(this[S]&&!this[R]&&!this[M]&&!this[I]){this[R]=!0;const t=this[c];if(t&&t.blockRemain){const e=this[g]?this[g].length:0;this.warn("TAR_BAD_ARCHIVE",`Truncated input (needed ${t.blockRemain} more bytes, only ${e} available)`,{entry:t}),this[g]&&t.write(this[g]),t.end()}this[v](C)}}[T](t){if(this[I])this[x](t);else if(t||this[g]){if(this[I]=!0,this[g]){this[x](t);const e=this[g];this[g]=null,this[k](e)}else this[k](t);for(;this[g]&&this[g].length>=512&&!this[M]&&!this[z];){const t=this[g];this[g]=null,this[k](t)}this[I]=!1}else this[N]();this[g]&&!this[S]||this[N]()}[k](t){let e=0;const i=t.length;for(;e+512<=i&&!this[M]&&!this[z];)switch(this[l]){case"begin":case"header":this[D](t,e),e+=512;break;case"ignore":case"body":e+=this[L](t,e);break;case"meta":e+=this[A](t,e);break;default:throw new Error("invalid state: "+this[l])}e<i&&(this[g]?this[g]=Buffer.concat([t.slice(e),this[g]]):this[g]=t.slice(e))}end(t){this[M]||(this[O]?this[O].end(t):(this[S]=!0,void 0===this.brotli&&(t=t||Buffer.alloc(0)),this.write(t)))}}),Bt}function Vt(){if(Ft)return Ct;Ft=1;const t=I(),e=Wt(),i=S,s=Zt(),r=E,n=Ot();Ct=(e,i,s)=>{"function"==typeof e?(s=e,i=null,e={}):Array.isArray(e)&&(i=e,e={}),"function"==typeof i&&(s=i,i=null),i=i?Array.from(i):[];const r=t(e);if(r.sync&&"function"==typeof s)throw new TypeError("callback not supported for sync tar functions");if(!r.file&&"function"==typeof s)throw new TypeError("callback only supported with file option");return i.length&&o(r,i),r.noResume||h(r),r.file&&r.sync?a(r):r.file?l(r,s):c(r)};const h=t=>{const e=t.onentry;t.onentry=e?t=>{e(t),t.resume()}:t=>t.resume()},o=(t,e)=>{const i=new Map(e.map((t=>[n(t),!0]))),s=t.filter,h=(t,e)=>{const s=e||r.parse(t).root||".",n=t!==s&&(i.has(t)?i.get(t):h(r.dirname(t),s));return i.set(t,n),n};t.filter=s?(t,e)=>s(t,e)&&h(n(t)):t=>h(n(t))},a=t=>{const e=c(t),s=t.file;let r,n=!0;try{const h=i.statSync(s),o=t.maxReadSize||16777216;if(h.size<o)e.end(i.readFileSync(s));else{let t=0;const n=Buffer.allocUnsafe(o);for(r=i.openSync(s,"r");t<h.size;){const s=i.readSync(r,n,0,o,t);t+=s,e.write(n.slice(0,s))}e.end()}n=!1}finally{if(n&&r)try{i.closeSync(r)}catch(t){}}},l=(t,r)=>{const n=new e(t),h=t.maxReadSize||16777216,o=t.file,a=new Promise(((t,e)=>{n.on("error",e),n.on("end",t),i.stat(o,((t,i)=>{if(t)e(t);else{const t=new s.ReadStream(o,{readSize:h,size:i.size});t.on("error",e),t.pipe(n)}}))}));return r?a.then(r,r):a},c=t=>new e(t);return Ct}function Yt(){if(jt)return Ut;jt=1;const t=I(),e=xt(),i=S,s=Zt(),r=Vt(),n=E,h=Rt();Ut=(e,i,s)=>{const r=t(e);if(!r.file)throw new TypeError("file is required");if(r.gzip||r.brotli||r.file.endsWith(".br")||r.file.endsWith(".tbr"))throw new TypeError("cannot append to compressed archives");if(!i||!Array.isArray(i)||!i.length)throw new TypeError("no files or directories specified");return i=Array.from(i),r.sync?o(r,i):l(r,i,s)};const o=(t,s)=>{const r=new e.Sync(t);let n,o,l=!0;try{try{n=i.openSync(t.file,"r+")}catch(e){if("ENOENT"!==e.code)throw e;n=i.openSync(t.file,"w+")}const e=i.fstatSync(n),c=Buffer.alloc(512);t:for(o=0;o<e.size;o+=512){for(let t=0,e=0;t<512;t+=e){if(e=i.readSync(n,c,t,c.length-t,o+t),0===o&&31===c[0]&&139===c[1])throw new Error("cannot append to compressed archives");if(!e)break t}const s=new h(c);if(!s.cksumValid)break;const r=512*Math.ceil(s.size/512);if(o+r+512>e.size)break;o+=r,t.mtimeCache&&t.mtimeCache.set(s.path,s.mtime)}l=!1,a(t,r,o,n,s)}finally{if(l)try{i.closeSync(n)}catch(t){}}},a=(t,e,i,r,n)=>{const h=new s.WriteStreamSync(t.file,{fd:r,start:i});e.pipe(h),c(e,n)},l=(t,r,n)=>{r=Array.from(r);const o=new e(t),a=new Promise(((e,n)=>{o.on("error",n);let a="r+";const l=(c,d)=>c&&"ENOENT"===c.code&&"r+"===a?(a="w+",i.open(t.file,a,l)):c?n(c):void i.fstat(d,((a,l)=>{if(a)return i.close(d,(()=>n(a)));((e,s,r)=>{const n=(t,s)=>{t?i.close(e,(e=>r(t))):r(null,s)};let o=0;if(0===s)return n(null,0);let a=0;const l=Buffer.alloc(512),c=(r,u)=>{if(r)return n(r);if(a+=u,a<512&&u)return i.read(e,l,a,l.length-a,o+a,c);if(0===o&&31===l[0]&&139===l[1])return n(new Error("cannot append to compressed archives"));if(a<512)return n(null,o);const d=new h(l);if(!d.cksumValid)return n(null,o);const f=512*Math.ceil(d.size/512);return o+f+512>s?n(null,o):(o+=f+512,o>=s?n(null,o):(t.mtimeCache&&t.mtimeCache.set(d.path,d.mtime),a=0,void i.read(e,l,0,512,o,c)))};i.read(e,l,0,512,o,c)})(d,l.size,((i,h)=>{if(i)return n(i);const a=new s.WriteStream(t.file,{fd:d,start:h});o.pipe(a),a.on("error",n),a.on("close",e),u(o,r)}))}));i.open(t.file,a,l)}));return n?a.then(n,n):a},c=(t,e)=>{e.forEach((e=>{"@"===e.charAt(0)?r({file:n.resolve(t.cwd,e.slice(1)),sync:!0,noResume:!0,onentry:e=>t.add(e)}):t.add(e)})),t.end()},u=(t,e)=>{for(;e.length;){const i=e.shift();if("@"===i.charAt(0))return r({file:n.resolve(t.cwd,i.slice(1)),noResume:!0,onentry:e=>t.add(e)}).then((i=>u(t,e)));t.add(i)}t.end()};return Ut}var Xt,Kt,qt,Jt,Qt,te,ee,ie,se,re,ne,he,oe,ae,le,ce,ue,de,fe,me,pe,ye,be,we,ge,Ee,Se,_e,Re={exports:{}};function ve(){if(ie)return ee;ie=1;const{dirname:t}=E,e=(i,s,r)=>{s.recursive=!1;const n=t(i);return n===i?s.mkdirAsync(i,s).catch((t=>{if("EISDIR"!==t.code)throw t})):s.mkdirAsync(i,s).then((()=>r||i),(t=>{if("ENOENT"===t.code)return e(n,s).then((t=>e(i,s,t)));if("EEXIST"!==t.code&&"EROFS"!==t.code)throw t;return s.statAsync(i).then((e=>{if(e.isDirectory())return r;throw t}),(()=>{throw t}))}))},i=(e,s,r)=>{const n=t(e);if(s.recursive=!1,n===e)try{return s.mkdirSync(e,s)}catch(t){if("EISDIR"!==t.code)throw t;return}try{return s.mkdirSync(e,s),r||e}catch(t){if("ENOENT"===t.code)return i(e,s,i(n,s,r));if("EEXIST"!==t.code&&"EROFS"!==t.code)throw t;try{if(!s.statSync(e).isDirectory())throw t}catch(e){throw t}}};return ee={mkdirpManual:e,mkdirpManualSync:i}}function Oe(){if(re)return se;re=1;const{dirname:t}=E,{findMade:e,findMadeSync:i}=function(){if(te)return Qt;te=1;const{dirname:t}=E,e=(i,s,r=void 0)=>r===s?Promise.resolve():i.statAsync(s).then((t=>t.isDirectory()?r:void 0),(r=>"ENOENT"===r.code?e(i,t(s),s):void 0)),i=(e,s,r=void 0)=>{if(r!==s)try{return e.statSync(s).isDirectory()?r:void 0}catch(r){return"ENOENT"===r.code?i(e,t(s),s):void 0}};return Qt={findMade:e,findMadeSync:i}}(),{mkdirpManual:s,mkdirpManualSync:r}=ve();return se={mkdirpNative:(i,r)=>{r.recursive=!0;return t(i)===i?r.mkdirAsync(i,r):e(r,i).then((t=>r.mkdirAsync(i,r).then((()=>t)).catch((t=>{if("ENOENT"===t.code)return s(i,r);throw t}))))},mkdirpNativeSync:(e,s)=>{s.recursive=!0;if(t(e)===e)return s.mkdirSync(e,s);const n=i(s,e);try{return s.mkdirSync(e,s),n}catch(t){if("ENOENT"===t.code)return r(e,s);throw t}}}}function Te(){if(ae)return oe;ae=1;const t=function(){if(Kt)return Xt;Kt=1;const{promisify:t}=R,e=S;return Xt=i=>{if(i)if("object"==typeof i)i={mode:511,fs:e,...i};else if("number"==typeof i)i={mode:i,fs:e};else{if("string"!=typeof i)throw new TypeError("invalid options argument");i={mode:parseInt(i,8),fs:e}}else i={mode:511,fs:e};return i.mkdir=i.mkdir||i.fs.mkdir||e.mkdir,i.mkdirAsync=t(i.mkdir),i.stat=i.stat||i.fs.stat||e.stat,i.statAsync=t(i.stat),i.statSync=i.statSync||i.fs.statSync||e.statSync,i.mkdirSync=i.mkdirSync||i.fs.mkdirSync||e.mkdirSync,i}}(),e=function(){if(Jt)return qt;Jt=1;const t=process.env.__TESTING_MKDIRP_PLATFORM__||process.platform,{resolve:e,parse:i}=E;return qt=s=>{if(/\0/.test(s))throw Object.assign(new TypeError("path must be a string without null bytes"),{path:s,code:"ERR_INVALID_ARG_VALUE"});if(s=e(s),"win32"===t){const t=/[*|"<>?:]/,{root:e}=i(s);if(t.test(s.substr(e.length)))throw Object.assign(new Error("Illegal characters in path."),{path:s,code:"EINVAL"})}return s}}(),{mkdirpNative:i,mkdirpNativeSync:s}=Oe(),{mkdirpManual:r,mkdirpManualSync:n}=ve(),{useNative:h,useNativeSync:o}=function(){if(he)return ne;he=1;const t=S,e=(process.env.__TESTING_MKDIRP_NODE_VERSION__||process.version).replace(/^v/,"").split("."),i=+e[0]>10||10==+e[0]&&+e[1]>=12;return ne={useNative:i?e=>e.mkdir===t.mkdir:()=>!1,useNativeSync:i?e=>e.mkdirSync===t.mkdirSync:()=>!1}}(),a=(s,n)=>(s=e(s),n=t(n),h(n)?i(s,n):r(s,n));return a.sync=(i,r)=>(i=e(i),r=t(r),o(r)?s(i,r):n(i,r)),a.native=(s,r)=>i(e(s),t(r)),a.manual=(i,s)=>r(e(i),t(s)),a.nativeSync=(i,r)=>s(e(i),t(r)),a.manualSync=(i,s)=>n(e(i),t(s)),oe=a}function ke(){if(ce)return le;ce=1;const t=S,e=E,i=t.lchown?"lchown":"chown",s=t.lchownSync?"lchownSync":"chownSync",r=t.lchown&&!process.version.match(/v1[1-9]+\./)&&!process.version.match(/v10\.[6-9]/),n=(e,i,r)=>{try{return t[s](e,i,r)}catch(t){if("ENOENT"!==t.code)throw t}},h=r?(e,i,s,r)=>n=>{n&&"EISDIR"===n.code?t.chown(e,i,s,r):r(n)}:(t,e,i,s)=>s,o=r?(e,i,s)=>{try{return n(e,i,s)}catch(r){if("EISDIR"!==r.code)throw r;((e,i,s)=>{try{return t.chownSync(e,i,s)}catch(t){if("ENOENT"!==t.code)throw t}})(e,i,s)}}:(t,e,i)=>n(t,e,i),a=process.version;let l=(e,i,s)=>t.readdir(e,i,s);/^v4\./.test(a)&&(l=(e,i,s)=>t.readdir(e,s));const c=(e,s,r,n)=>{t[i](e,s,r,h(e,s,r,(t=>{n(t&&"ENOENT"!==t.code?t:null)})))},u=(i,s,r,n,h)=>{if("string"==typeof s)return t.lstat(e.resolve(i,s),((t,e)=>{if(t)return h("ENOENT"!==t.code?t:null);e.name=s,u(i,e,r,n,h)}));if(s.isDirectory())d(e.resolve(i,s.name),r,n,(t=>{if(t)return h(t);const o=e.resolve(i,s.name);c(o,r,n,h)}));else{const t=e.resolve(i,s.name);c(t,r,n,h)}},d=(t,e,i,s)=>{l(t,{withFileTypes:!0},((r,n)=>{if(r){if("ENOENT"===r.code)return s();if("ENOTDIR"!==r.code&&"ENOTSUP"!==r.code)return s(r)}if(r||!n.length)return c(t,e,i,s);let h=n.length,o=null;const a=r=>{if(!o)return r?s(o=r):0==--h?c(t,e,i,s):void 0};n.forEach((s=>u(t,s,e,i,a)))}))},f=(i,s,r)=>{let n;try{n=((e,i)=>t.readdirSync(e,i))(i,{withFileTypes:!0})}catch(t){if("ENOENT"===t.code)return;if("ENOTDIR"===t.code||"ENOTSUP"===t.code)return o(i,s,r);throw t}return n&&n.length&&n.forEach((n=>((i,s,r,n)=>{if("string"==typeof s)try{const r=t.lstatSync(e.resolve(i,s));r.name=s,s=r}catch(t){if("ENOENT"===t.code)return;throw t}s.isDirectory()&&f(e.resolve(i,s.name),r,n),o(e.resolve(i,s.name),r,n)})(i,n,s,r))),o(i,s,r)};return le=d,d.sync=f,le}function Le(){if(ue)return Re.exports;ue=1;const t=Te(),e=S,i=E,s=ke(),r=Y();class n extends Error{constructor(t,e){super("Cannot extract through symbolic link"),this.path=e,this.symlink=t}get name(){return"SylinkError"}}class h extends Error{constructor(t,e){super(e+": Cannot cd into '"+t+"'"),this.path=t,this.code=e}get name(){return"CwdError"}}const o=(t,e)=>t.get(r(e)),a=(t,e,i)=>t.set(r(e),i);Re.exports=(n,c,u)=>{n=r(n);const d=c.umask,f=448|c.mode,m=!!(f&d),p=c.uid,y=c.gid,b="number"==typeof p&&"number"==typeof y&&(p!==c.processUid||y!==c.processGid),w=c.preserve,g=c.unlink,E=c.cache,S=r(c.cwd),_=(t,i)=>{t?u(t):(a(E,n,!0),i&&b?s(i,p,y,(t=>_(t))):m?e.chmod(n,f,u):u())};if(E&&!0===o(E,n))return _();if(n===S)return((t,i)=>{e.stat(t,((e,s)=>{!e&&s.isDirectory()||(e=new h(t,e&&e.code||"ENOTDIR")),i(e)}))})(n,_);if(w)return t(n,{mode:f}).then((t=>_(null,t)),_);const R=r(i.relative(S,n)).split("/");l(S,R,f,E,g,S,null,_)};const l=(t,s,n,h,a,u,d,f)=>{if(!s.length)return f(null,d);const m=s.shift(),p=r(i.resolve(t+"/"+m));if(o(h,p))return l(p,s,n,h,a,u,d,f);e.mkdir(p,n,c(p,s,n,h,a,u,d,f))},c=(t,i,s,h,o,a,u,d)=>f=>{f?e.lstat(t,((m,p)=>{if(m)m.path=m.path&&r(m.path),d(m);else if(p.isDirectory())l(t,i,s,h,o,a,u,d);else if(o)e.unlink(t,(r=>{if(r)return d(r);e.mkdir(t,s,c(t,i,s,h,o,a,u,d))}));else{if(p.isSymbolicLink())return d(new n(t,t+"/"+i.join("/")));d(f)}})):l(t,i,s,h,o,a,u=u||t,d)};return Re.exports.sync=(l,c)=>{l=r(l);const u=c.umask,d=448|c.mode,f=!!(d&u),m=c.uid,p=c.gid,y="number"==typeof m&&"number"==typeof p&&(m!==c.processUid||p!==c.processGid),b=c.preserve,w=c.unlink,g=c.cache,E=r(c.cwd),S=t=>{a(g,l,!0),t&&y&&s.sync(t,m,p),f&&e.chmodSync(l,d)};if(g&&!0===o(g,l))return S();if(l===E)return(t=>{let i=!1,s="ENOTDIR";try{i=e.statSync(t).isDirectory()}catch(t){s=t.code}finally{if(!i)throw new h(t,s)}})(E),S();if(b)return S(t.sync(l,d));const _=r(i.relative(E,l)).split("/");let R=null;for(let t=_.shift(),s=E;t&&(s+="/"+t);t=_.shift())if(s=r(i.resolve(s)),!o(g,s))try{e.mkdirSync(s,d),R=R||s,a(g,s,!0)}catch(t){const i=e.lstatSync(s);if(i.isDirectory()){a(g,s,!0);continue}if(w){e.unlinkSync(s),e.mkdirSync(s,d),R=R||s,a(g,s,!0);continue}if(i.isSymbolicLink())return new n(s,s+"/"+_.join("/"))}return S(R)},Re.exports}function Ae(){if(fe)return de;fe=1;const t=Object.create(null),{hasOwnProperty:e}=Object.prototype;return de=i=>(e.call(t,i)||(t[i]=i.normalize("NFD")),t[i])}function De(){if(pe)return me;pe=1;const t=b,e=Ae(),i=Ot(),{join:s}=E,r="win32"===(process.env.TESTING_TAR_FAKE_PLATFORM||process.platform);return me=()=>{const n=new Map,h=new Map,o=new Set,a=t=>{const{paths:e,dirs:i}=(t=>{const e=h.get(t);if(!e)throw new Error("function does not have any path reservations");return{paths:e.paths.map((t=>n.get(t))),dirs:[...e.dirs].map((t=>n.get(t)))}})(t);return e.every((e=>e[0]===t))&&i.every((e=>e[0]instanceof Set&&e[0].has(t)))},l=t=>!(o.has(t)||!a(t))&&(o.add(t),t((()=>c(t))),!0),c=e=>{if(!o.has(e))return!1;const{paths:i,dirs:s}=h.get(e),r=new Set;return i.forEach((i=>{const s=n.get(i);t.equal(s[0],e),1===s.length?n.delete(i):(s.shift(),"function"==typeof s[0]?r.add(s[0]):s[0].forEach((t=>r.add(t))))})),s.forEach((i=>{const s=n.get(i);t(s[0]instanceof Set),1===s[0].size&&1===s.length?n.delete(i):1===s[0].size?(s.shift(),r.add(s[0])):s[0].delete(e)})),o.delete(e),r.forEach((t=>l(t))),!0};return{check:a,reserve:(t,o)=>{t=r?["win32 parallelization disabled"]:t.map((t=>i(s(e(t))).toLowerCase()));const a=new Set(t.map((t=>(t=>{const e=t.split("/").slice(0,-1).reduce(((t,e)=>(t.length&&(e=s(t[t.length-1],e)),t.push(e||"/"),t)),[]);return e})(t))).reduce(((t,e)=>t.concat(e))));return h.set(o,{dirs:a,paths:t}),t.forEach((t=>{const e=n.get(t);e?e.push(o):n.set(t,[o])})),a.forEach((t=>{const e=n.get(t);e?e[e.length-1]instanceof Set?e[e.length-1].add(o):e.push(new Set([o])):n.set(t,[new Set([o])])})),l(o)}}},me}function Ie(){if(ge)return we;ge=1;const t=b,e=Wt(),i=S,s=Zt(),r=E,n=Le(),h=kt(),a=De(),l=Lt(),c=Y(),u=Ot(),d=Ae(),f=Symbol("onEntry"),m=Symbol("checkFs"),p=Symbol("checkFs2"),y=Symbol("pruneCache"),w=Symbol("isReusable"),g=Symbol("makeFs"),_=Symbol("file"),R=Symbol("directory"),O=Symbol("link"),T=Symbol("symlink"),k=Symbol("hardlink"),L=Symbol("unsupported"),A=Symbol("checkPath"),D=Symbol("mkdir"),I=Symbol("onError"),x=Symbol("pending"),N=Symbol("pend"),B=Symbol("unpend"),M=Symbol("ended"),C=Symbol("maybeClose"),F=Symbol("skip"),P=Symbol("doChown"),z=Symbol("uid"),U=Symbol("gid"),j=Symbol("checkedCwd"),$=v,G=function(){if(be)return ye;be=1;const t="win32"===(process.env.__FAKE_PLATFORM__||process.platform),e=o.__FAKE_TESTING_FS__||S,{O_CREAT:i,O_TRUNC:s,O_WRONLY:r,UV_FS_O_FILEMAP:n=0}=e.constants,h=n|s|i|r;return ye=t&&n?t=>t<524288?h:"w":()=>"w"}(),H="win32"===(process.env.TESTING_TAR_FAKE_PLATFORM||process.platform),Z=(t,e,i)=>t===t>>>0?t:e===e>>>0?e:i,W=t=>u(c(d(t))).toLowerCase();class V extends e{constructor(t){if(t||(t={}),t.ondone=t=>{this[M]=!0,this[C]()},super(t),this[j]=!1,this.reservations=a(),this.transform="function"==typeof t.transform?t.transform:null,this.writable=!0,this.readable=!1,this[x]=0,this[M]=!1,this.dirCache=t.dirCache||new Map,"number"==typeof t.uid||"number"==typeof t.gid){if("number"!=typeof t.uid||"number"!=typeof t.gid)throw new TypeError("cannot set owner without number uid and gid");if(t.preserveOwner)throw new TypeError("cannot preserve owner in archive and also set owner explicitly");this.uid=t.uid,this.gid=t.gid,this.setOwner=!0}else this.uid=null,this.gid=null,this.setOwner=!1;void 0===t.preserveOwner&&"number"!=typeof t.uid?this.preserveOwner=process.getuid&&0===process.getuid():this.preserveOwner=!!t.preserveOwner,this.processUid=(this.preserveOwner||this.setOwner)&&process.getuid?process.getuid():null,this.processGid=(this.preserveOwner||this.setOwner)&&process.getgid?process.getgid():null,this.maxDepth="number"==typeof t.maxDepth?t.maxDepth:1024,this.forceChown=!0===t.forceChown,this.win32=!!t.win32||H,this.newer=!!t.newer,this.keep=!!t.keep,this.noMtime=!!t.noMtime,this.preservePaths=!!t.preservePaths,this.unlink=!!t.unlink,this.cwd=c(r.resolve(t.cwd||process.cwd())),this.strip=+t.strip||0,this.processUmask=t.noChmod?0:process.umask(),this.umask="number"==typeof t.umask?t.umask:this.processUmask,this.dmode=t.dmode||511&~this.umask,this.fmode=t.fmode||438&~this.umask,this.on("entry",(t=>this[f](t)))}warn(t,e,i={}){return"TAR_BAD_ARCHIVE"!==t&&"TAR_ABORT"!==t||(i.recoverable=!1),super.warn(t,e,i)}[C](){this[M]&&0===this[x]&&(this.emit("prefinish"),this.emit("finish"),this.emit("end"))}[A](t){const e=c(t.path),i=e.split("/");if(this.strip){if(i.length<this.strip)return!1;if("Link"===t.type){const e=c(t.linkpath).split("/");if(!(e.length>=this.strip))return!1;t.linkpath=e.slice(this.strip).join("/")}i.splice(0,this.strip),t.path=i.join("/")}if(isFinite(this.maxDepth)&&i.length>this.maxDepth)return this.warn("TAR_ENTRY_ERROR","path excessively deep",{entry:t,path:e,depth:i.length,maxDepth:this.maxDepth}),!1;if(!this.preservePaths){if(i.includes("..")||H&&/^[a-z]:\.\.$/i.test(i[0]))return this.warn("TAR_ENTRY_ERROR","path contains '..'",{entry:t,path:e}),!1;const[s,r]=l(e);s&&(t.path=r,this.warn("TAR_ENTRY_INFO",`stripping ${s} from absolute path`,{entry:t,path:e}))}if(r.isAbsolute(t.path)?t.absolute=c(r.resolve(t.path)):t.absolute=c(r.resolve(this.cwd,t.path)),!this.preservePaths&&0!==t.absolute.indexOf(this.cwd+"/")&&t.absolute!==this.cwd)return this.warn("TAR_ENTRY_ERROR","path escaped extraction target",{entry:t,path:c(t.path),resolvedPath:t.absolute,cwd:this.cwd}),!1;if(t.absolute===this.cwd&&"Directory"!==t.type&&"GNUDumpDir"!==t.type)return!1;if(this.win32){const{root:e}=r.win32.parse(t.absolute);t.absolute=e+h.encode(t.absolute.slice(e.length));const{root:i}=r.win32.parse(t.path);t.path=i+h.encode(t.path.slice(i.length))}return!0}[f](e){if(!this[A](e))return e.resume();switch(t.equal(typeof e.absolute,"string"),e.type){case"Directory":case"GNUDumpDir":e.mode&&(e.mode=448|e.mode);case"File":case"OldFile":case"ContiguousFile":case"Link":case"SymbolicLink":return this[m](e);default:return this[L](e)}}[I](t,e){"CwdError"===t.name?this.emit("error",t):(this.warn("TAR_ENTRY_ERROR",t,{entry:e}),this[B](),e.resume())}[D](t,e,i){n(c(t),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:e,noChmod:this.noChmod},i)}[P](t){return this.forceChown||this.preserveOwner&&("number"==typeof t.uid&&t.uid!==this.processUid||"number"==typeof t.gid&&t.gid!==this.processGid)||"number"==typeof this.uid&&this.uid!==this.processUid||"number"==typeof this.gid&&this.gid!==this.processGid}[z](t){return Z(this.uid,t.uid,this.processUid)}[U](t){return Z(this.gid,t.gid,this.processGid)}[_](t,e){const r=4095&t.mode||this.fmode,n=new s.WriteStream(t.absolute,{flags:G(t.size),mode:r,autoClose:!1});n.on("error",(s=>{n.fd&&i.close(n.fd,(()=>{})),n.write=()=>!0,this[I](s,t),e()}));let h=1;const o=s=>{if(s)return n.fd&&i.close(n.fd,(()=>{})),this[I](s,t),void e();0==--h&&i.close(n.fd,(i=>{i?this[I](i,t):this[B](),e()}))};n.on("finish",(e=>{const s=t.absolute,r=n.fd;if(t.mtime&&!this.noMtime){h++;const e=t.atime||new Date,n=t.mtime;i.futimes(r,e,n,(t=>t?i.utimes(s,e,n,(e=>o(e&&t))):o()))}if(this[P](t)){h++;const e=this[z](t),n=this[U](t);i.fchown(r,e,n,(t=>t?i.chown(s,e,n,(e=>o(e&&t))):o()))}o()}));const a=this.transform&&this.transform(t)||t;a!==t&&(a.on("error",(i=>{this[I](i,t),e()})),t.pipe(a)),a.pipe(n)}[R](t,e){const s=4095&t.mode||this.dmode;this[D](t.absolute,s,(s=>{if(s)return this[I](s,t),void e();let r=1;const n=i=>{0==--r&&(e(),this[B](),t.resume())};t.mtime&&!this.noMtime&&(r++,i.utimes(t.absolute,t.atime||new Date,t.mtime,n)),this[P](t)&&(r++,i.chown(t.absolute,this[z](t),this[U](t),n)),n()}))}[L](t){t.unsupported=!0,this.warn("TAR_ENTRY_UNSUPPORTED",`unsupported entry type: ${t.type}`,{entry:t}),t.resume()}[T](t,e){this[O](t,t.linkpath,"symlink",e)}[k](t,e){const i=c(r.resolve(this.cwd,t.linkpath));this[O](t,i,"link",e)}[N](){this[x]++}[B](){this[x]--,this[C]()}[F](t){this[B](),t.resume()}[w](t,e){return"File"===t.type&&!this.unlink&&e.isFile()&&e.nlink<=1&&!H}[m](t){this[N]();const e=[t.path];t.linkpath&&e.push(t.linkpath),this.reservations.reserve(e,(e=>this[p](t,e)))}[y](t){"SymbolicLink"===t.type?(t=>{for(const e of t.keys())t.delete(e)})(this.dirCache):"Directory"!==t.type&&((t,e)=>{e=W(e);for(const i of t.keys()){const s=W(i);s!==e&&0!==s.indexOf(e+"/")||t.delete(i)}})(this.dirCache,t.absolute)}[p](t,e){this[y](t);const s=i=>{this[y](t),e(i)},n=()=>{this[D](this.cwd,this.dmode,(e=>{if(e)return this[I](e,t),void s();this[j]=!0,h()}))},h=()=>{if(t.absolute!==this.cwd){const e=c(r.dirname(t.absolute));if(e!==this.cwd)return this[D](e,this.dmode,(e=>{if(e)return this[I](e,t),void s();o()}))}o()},o=()=>{i.lstat(t.absolute,((e,r)=>{if(r&&(this.keep||this.newer&&r.mtime>t.mtime))return this[F](t),void s();if(e||this[w](t,r))return this[g](null,t,s);if(r.isDirectory()){if("Directory"===t.type){const e=e=>this[g](e,t,s);return!this.noChmod&&t.mode&&(4095&r.mode)!==t.mode?i.chmod(t.absolute,t.mode,e):e()}if(t.absolute!==this.cwd)return i.rmdir(t.absolute,(e=>this[g](e,t,s)))}if(t.absolute===this.cwd)return this[g](null,t,s);((t,e)=>{if(!H)return i.unlink(t,e);const s=t+".DELETE."+$.randomBytes(16).toString("hex");i.rename(t,s,(t=>{if(t)return e(t);i.unlink(s,e)}))})(t.absolute,(e=>this[g](e,t,s)))}))};this[j]?h():n()}[g](t,e,i){if(t)return this[I](t,e),void i();switch(e.type){case"File":case"OldFile":case"ContiguousFile":return this[_](e,i);case"Link":return this[k](e,i);case"SymbolicLink":return this[T](e,i);case"Directory":case"GNUDumpDir":return this[R](e,i)}}[O](t,e,s,r){i[s](e,t.absolute,(e=>{e?this[I](e,t):(this[B](),t.resume()),r()}))}}const X=t=>{try{return[null,t()]}catch(t){return[t,null]}};return V.Sync=class extends V{[g](t,e){return super[g](t,e,(()=>{}))}[m](t){if(this[y](t),!this[j]){const e=this[D](this.cwd,this.dmode);if(e)return this[I](e,t);this[j]=!0}if(t.absolute!==this.cwd){const e=c(r.dirname(t.absolute));if(e!==this.cwd){const i=this[D](e,this.dmode);if(i)return this[I](i,t)}}const[e,s]=X((()=>i.lstatSync(t.absolute)));if(s&&(this.keep||this.newer&&s.mtime>t.mtime))return this[F](t);if(e||this[w](t,s))return this[g](null,t);if(s.isDirectory()){if("Directory"===t.type){const e=!this.noChmod&&t.mode&&(4095&s.mode)!==t.mode,[r]=e?X((()=>{i.chmodSync(t.absolute,t.mode)})):[];return this[g](r,t)}const[e]=X((()=>i.rmdirSync(t.absolute)));this[g](e,t)}const[n]=t.absolute===this.cwd?[]:X((()=>(t=>{if(!H)return i.unlinkSync(t);const e=t+".DELETE."+$.randomBytes(16).toString("hex");i.renameSync(t,e),i.unlinkSync(e)})(t.absolute)));this[g](n,t)}[_](t,e){const s=4095&t.mode||this.fmode,r=s=>{let r;try{i.closeSync(n)}catch(t){r=t}(s||r)&&this[I](s||r,t),e()};let n;try{n=i.openSync(t.absolute,G(t.size),s)}catch(t){return r(t)}const h=this.transform&&this.transform(t)||t;h!==t&&(h.on("error",(e=>this[I](e,t))),t.pipe(h)),h.on("data",(t=>{try{i.writeSync(n,t,0,t.length)}catch(t){r(t)}})),h.on("end",(e=>{let s=null;if(t.mtime&&!this.noMtime){const e=t.atime||new Date,r=t.mtime;try{i.futimesSync(n,e,r)}catch(n){try{i.utimesSync(t.absolute,e,r)}catch(t){s=n}}}if(this[P](t)){const e=this[z](t),r=this[U](t);try{i.fchownSync(n,e,r)}catch(n){try{i.chownSync(t.absolute,e,r)}catch(t){s=s||n}}}r(s)}))}[R](t,e){const s=4095&t.mode||this.dmode,r=this[D](t.absolute,s);if(r)return this[I](r,t),void e();if(t.mtime&&!this.noMtime)try{i.utimesSync(t.absolute,t.atime||new Date,t.mtime)}catch(r){}if(this[P](t))try{i.chownSync(t.absolute,this[z](t),this[U](t))}catch(r){}e(),t.resume()}[D](t,e){try{return n.sync(c(t),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:e})}catch(t){return t}}[O](t,e,s,r){try{i[s+"Sync"](e,t.absolute),r(),t.resume()}catch(e){return this[I](e,t)}}},we=V}var xe=(_e||(_e=1,D.c=D.create=function(){if(zt)return Pt;zt=1;const t=I(),e=xt(),i=Zt(),s=Vt(),r=E;Pt=(e,i,s)=>{if("function"==typeof i&&(s=i),Array.isArray(e)&&(i=e,e={}),!i||!Array.isArray(i)||!i.length)throw new TypeError("no files or directories specified");i=Array.from(i);const r=t(e);if(r.sync&&"function"==typeof s)throw new TypeError("callback not supported for sync tar functions");if(!r.file&&"function"==typeof s)throw new TypeError("callback only supported with file option");return r.file&&r.sync?n(r,i):r.file?h(r,i,s):r.sync?l(r,i):c(r,i)};const n=(t,s)=>{const r=new e.Sync(t),n=new i.WriteStreamSync(t.file,{mode:t.mode||438});r.pipe(n),o(r,s)},h=(t,s,r)=>{const n=new e(t),h=new i.WriteStream(t.file,{mode:t.mode||438});n.pipe(h);const o=new Promise(((t,e)=>{h.on("error",e),h.on("close",t),n.on("error",e)}));return a(n,s),r?o.then(r,r):o},o=(t,e)=>{e.forEach((e=>{"@"===e.charAt(0)?s({file:r.resolve(t.cwd,e.slice(1)),sync:!0,noResume:!0,onentry:e=>t.add(e)}):t.add(e)})),t.end()},a=(t,e)=>{for(;e.length;){const i=e.shift();if("@"===i.charAt(0))return s({file:r.resolve(t.cwd,i.slice(1)),noResume:!0,onentry:e=>t.add(e)}).then((i=>a(t,e)));t.add(i)}t.end()},l=(t,i)=>{const s=new e.Sync(t);return o(s,i),s},c=(t,i)=>{const s=new e(t);return a(s,i),s};return Pt}(),D.r=D.replace=Yt(),D.t=D.list=Vt(),D.u=D.update=function(){if(Gt)return $t;Gt=1;const t=I(),e=Yt();$t=(s,r,n)=>{const h=t(s);if(!h.file)throw new TypeError("file is required");if(h.gzip||h.brotli||h.file.endsWith(".br")||h.file.endsWith(".tbr"))throw new TypeError("cannot append to compressed archives");if(!r||!Array.isArray(r)||!r.length)throw new TypeError("no files or directories specified");return r=Array.from(r),i(h),e(h,r,n)};const i=t=>{const e=t.filter;t.mtimeCache||(t.mtimeCache=new Map),t.filter=e?(i,s)=>e(i,s)&&!(t.mtimeCache.get(i)>s.mtime):(e,i)=>!(t.mtimeCache.get(e)>i.mtime)};return $t}(),D.x=D.extract=function(){if(Se)return Ee;Se=1;const t=I(),e=Ie(),i=S,s=Zt(),r=E,n=Ot();Ee=(e,i,s)=>{"function"==typeof e?(s=e,i=null,e={}):Array.isArray(e)&&(i=e,e={}),"function"==typeof i&&(s=i,i=null),i=i?Array.from(i):[];const r=t(e);if(r.sync&&"function"==typeof s)throw new TypeError("callback not supported for sync tar functions");if(!r.file&&"function"==typeof s)throw new TypeError("callback only supported with file option");return i.length&&h(r,i),r.file&&r.sync?o(r):r.file?a(r,s):r.sync?l(r):c(r)};const h=(t,e)=>{const i=new Map(e.map((t=>[n(t),!0]))),s=t.filter,h=(t,e)=>{const s=e||r.parse(t).root||".",n=t!==s&&(i.has(t)?i.get(t):h(r.dirname(t),s));return i.set(t,n),n};t.filter=s?(t,e)=>s(t,e)&&h(n(t)):t=>h(n(t))},o=t=>{const r=new e.Sync(t),n=t.file,h=i.statSync(n),o=t.maxReadSize||16777216;new s.ReadStreamSync(n,{readSize:o,size:h.size}).pipe(r)},a=(t,r)=>{const n=new e(t),h=t.maxReadSize||16777216,o=t.file,a=new Promise(((t,e)=>{n.on("error",e),n.on("close",t),i.stat(o,((t,i)=>{if(t)e(t);else{const t=new s.ReadStream(o,{readSize:h,size:i.size});t.on("error",e),t.pipe(n)}}))}));return r?a.then(r,r):a},l=t=>new e.Sync(t),c=t=>new e(t);return Ee}(),D.Pack=xt(),D.Unpack=Ie(),D.Parse=Wt(),D.ReadEntry=X(),D.WriteEntry=Dt(),D.Header=Rt(),D.Pax=vt(),D.types=_t()),D);function Ne(t){let e;return()=>(void 0===e&&(e=t().then((t=>(e=t,e)))),e)}const Be=Ne((()=>import("./index-CjQdU556.js").then((t=>t.execa)))),Me=Ne((async()=>{try{const t=await Be();return await t("corepack",["--version"]),!0}catch{return!1}}));async function Ce(e={}){const i=e.cwd||process.cwd(),s=("string"==typeof e.packageManager?Fe.find((t=>t.name===e.packageManager)):e.packageManager)||await async function(e,i={}){const s=await async function(t,e,i={}){const s=c(t).split("/");for(;s.length>0;){const t=s.join("/")||"/",r=await e(t);if(r||!i.includeParentDirs)return r;s.pop()}}(a(e||"."),(async e=>{if(!i.ignorePackageJSON){const i=l(e,"package.json");if(r(i)){const e=JSON.parse(await t(i,"utf8"));if(e?.packageManager){const[t,i="0.0.0"]=e.packageManager.split("@"),s=i.split(".")[0];return{...Fe.find((e=>e.name===t&&e.majorVersion===s))||Fe.find((e=>e.name===t)),name:t,command:t,version:i,majorVersion:s}}}}if(!i.ignoreLockFile)for(const t of Fe){if([t.lockFile,t.files].flat().filter(Boolean).some((t=>r(a(e,t)))))return{...t}}}),{includeParentDirs:i.includeParentDirs??!0});if(!s&&!i.ignoreArgv){const t=process.argv[1];if(t)for(const e of Fe){if(new RegExp(`[/\\\\]\\.?${e.command}`).test(t))return e}}return s}(e.cwd||process.cwd());if(!s)throw new Error("No package manager auto-detected.");return{cwd:i,silent:e.silent??!1,packageManager:s,dev:e.dev??!1,workspace:e.workspace,global:e.global??!1}}const Fe=[{name:"npm",command:"npm",lockFile:"package-lock.json"},{name:"pnpm",command:"pnpm",lockFile:"pnpm-lock.yaml",files:["pnpm-workspace.yaml"]},{name:"bun",command:"bun",lockFile:["bun.lockb","bun.lock"]},{name:"yarn",command:"yarn",majorVersion:"1",lockFile:"yarn.lock"},{name:"yarn",command:"yarn",majorVersion:"3",lockFile:"yarn.lock",files:[".yarnrc.yml"]}];async function Pe(t={}){const e=await Ce(t),i=t.frozenLockFile?{npm:["ci"],yarn:["install","--immutable"],bun:["install","--frozen-lockfile"],pnpm:["install","--frozen-lockfile"]}[e.packageManager.name]:["install"];await async function(t,e,i={}){const s="npm"!==t&&"bun"!==t&&await Me()?["corepack",[t,...e]]:[t,e],r=await Be();await r(s[0],s[1],{cwd:a(i.cwd||process.cwd()),stdio:i.silent?"pipe":"inherit"})}(e.packageManager.command,i,{cwd:e.cwd,silent:e.silent})}var ze=Object.defineProperty,Ue=(t,e)=>ze(t,"name",{value:e,configurable:!0}),je=Object.defineProperty,$e=Ue(((t,e)=>je(t,"name",{value:e,configurable:!0})),"e");function Ge(){return{agent:void 0,dispatcher:void 0}}function He(){return globalThis.fetch}Ue(Ge,"createProxy"),$e(Ge,"createProxy"),Ue(He,"createFetch"),$e(He,"createFetch");const Ze=globalThis.fetch;const We=/^(?<repo>[\w.-]+\/[\w.-]+)(?<subdir>[^#]+)?(?<ref>#[\w./@-]+)?/;function Ve(t){const e=t.match(We)?.groups||{};return{repo:e.repo,subdir:e.subdir||"/",ref:e.ref?e.ref.slice(1):"main"}}function Ye(...t){process.env.DEBUG&&console.debug("[giget]",...t)}async function Xe(t,e={}){e.headers?.["sec-fetch-mode"]&&(e.mode=e.headers["sec-fetch-mode"]);const i=await Ze(t,{...e,headers:Ke(e.headers)}).catch((e=>{throw new Error(`Failed to download ${t}: ${e}`,{cause:e})}));if(e.validateStatus&&i.status>=400)throw new Error(`Failed to fetch ${t}: ${i.status} ${i.statusText}`);return i}function Ke(t={}){const e={};for(const[i,s]of Object.entries(t))s&&(e[i.toLowerCase()]=s);return e}const qe=async(t,e)=>{if(t.endsWith(".json"))return await Je(t,e);const i=new URL(t);let s=f(i.pathname);try{const r=await Xe(i.href,{method:"HEAD",validateStatus:!0,headers:{authorization:e.auth?`Bearer ${e.auth}`:void 0}});if((r.headers.get("content-type")||"").includes("application/json"))return await Je(t,e);const n=r.headers.get("content-disposition")?.match(/filename="?(.+)"?/)?.[1];n&&(s=n.split(".")[0])}catch(t){Ye(`Failed to fetch HEAD for ${i.href}:`,t)}return{name:`${s}-${i.href.slice(0,8)}`,version:"",subdir:"",tar:i.href,defaultDir:s,headers:{Authorization:e.auth?`Bearer ${e.auth}`:void 0}}},Je=async(t,e)=>{const i=await Xe(t,{validateStatus:!0,headers:{authorization:e.auth?`Bearer ${e.auth}`:void 0}}),s=await i.json();if(!s.tar||!s.name)throw new Error(`Invalid template info from ${t}. name or tar fields are missing!`);return s},Qe=(t,e)=>{const i=Ve(t),s=process.env.GIGET_GITHUB_URL||"https://api.github.com";return{name:i.repo.replace("/","-"),version:i.ref,subdir:i.subdir,headers:{Authorization:e.auth?`Bearer ${e.auth}`:void 0,Accept:"application/vnd.github+json","X-GitHub-Api-Version":"2022-11-28"},url:`${s.replace("api.github.com","github.com")}/${i.repo}/tree/${i.ref}${i.subdir}`,tar:`${s}/repos/${i.repo}/tarball/${i.ref}`}},ti={http:qe,https:qe,github:Qe,gh:Qe,gitlab:(t,e)=>{const i=Ve(t),s=process.env.GIGET_GITLAB_URL||"https://gitlab.com";return{name:i.repo.replace("/","-"),version:i.ref,subdir:i.subdir,headers:{authorization:e.auth?`Bearer ${e.auth}`:void 0,"sec-fetch-mode":"same-origin"},url:`${s}/${i.repo}/tree/${i.ref}${i.subdir}`,tar:`${s}/${i.repo}/-/archive/${i.ref}.tar.gz`}},bitbucket:(t,e)=>{const i=Ve(t);return{name:i.repo.replace("/","-"),version:i.ref,subdir:i.subdir,headers:{authorization:e.auth?`Bearer ${e.auth}`:void 0},url:`https://bitbucket.com/${i.repo}/src/${i.ref}${i.subdir}`,tar:`https://bitbucket.org/${i.repo}/get/${i.ref}.tar.gz`}},sourcehut:(t,e)=>{const i=Ve(t);return{name:i.repo.replace("/","-"),version:i.ref,subdir:i.subdir,headers:{authorization:e.auth?`Bearer ${e.auth}`:void 0},url:`https://git.sr.ht/~${i.repo}/tree/${i.ref}/item${i.subdir}`,tar:`https://git.sr.ht/~${i.repo}/archive/${i.ref}.tar.gz`}}},ei=(t="https://raw.githubusercontent.com/unjs/giget/main/templates",e={})=>async i=>{const s=Date.now(),r=`${t}/${i}.json`,n=await Xe(r,{headers:{authorization:e.auth?`Bearer ${e.auth}`:void 0}});if(n.status>=400)throw new Error(`Failed to download ${i} template info from ${r}: ${n.status} ${n.statusText}`);const h=await n.json();if(!h.tar||!h.name)throw new Error(`Invalid template info from ${r}. name or tar fields are missing!`);return Ye(`Fetched ${i} template info from ${r} in ${Date.now()-s}ms`),h},ii=/^([\w-.]+):/;async function si(o,l={}){const c=!1===(l=u({registry:process.env.GIGET_REGISTRY,auth:process.env.GIGET_AUTH},l)).registry?void 0:ei(l.registry,{auth:l.auth});let f=l.provider||(c?"registry":"github"),m=o;const p=o.match(ii);p&&(f=p[1],m=o.slice(p[0].length),"http"!==f&&"https"!==f||(m=o));const y=l.providers?.[f]||ti[f]||c;if(!y)throw new Error(`Unsupported provider: ${f}`);const b=await Promise.resolve().then((()=>y(m,{auth:l.auth}))).catch((t=>{throw new Error(`Failed to download template from ${f}: ${t.message}`)}));if(!b)throw new Error(`Failed to resolve template from ${f}`);b.name=(b.name||"template").replace(/[^\da-z-]/gi,"-"),b.defaultDir=(b.defaultDir||b.name).replace(/[^\da-z-]/gi,"-");const w=a(process.env.XDG_CACHE_HOME?a(process.env.XDG_CACHE_HOME,"giget"):a(T(),".cache/giget"),f,b.name),g=a(w,(b.version||b.name)+".tar.gz");if(l.preferOffline&&r(g)&&(l.offline=!0),!l.offline){await e(d(g),{recursive:!0});const i=Date.now();await async function(e,i,n={}){const o=i+".json",a=JSON.parse(await t(o,"utf8").catch((()=>"{}"))),l=await Xe(e,{method:"HEAD",headers:n.headers}).catch((()=>{})),c=l?.headers.get("etag");if(a.etag===c&&r(i))return;"string"==typeof c&&(a.etag=c);const u=await Xe(e,{headers:n.headers});if(u.status>=400)throw new Error(`Failed to download ${e}: ${u.status} ${u.statusText}`);const d=h(i);await k(O)(u.body,d),await s(o,JSON.stringify(a),"utf8")}(b.tar,g,{headers:{Authorization:l.auth?`Bearer ${l.auth}`:void 0,...Ke(b.headers)}}).catch((t=>{if(!r(g))throw t;Ye("Download error. Using cached version:",t),l.offline=!0})),Ye(`Downloaded ${b.tar} to ${g} in ${Date.now()-i}ms`)}if(!r(g))throw new Error(`Tarball not found: ${g} (offline: ${l.offline})`);const E=a(l.cwd||"."),S=a(E,l.dir||b.defaultDir);if(l.forceClean&&await i(S,{recursive:!0,force:!0}),!l.force&&r(S)&&n(S).length>0)throw new Error(`Destination ${S} already exists.`);await e(S,{recursive:!0});const _=Date.now(),R=b.subdir?.replace(/^\//,"")||"";return await xe.extract({file:g,cwd:S,onentry(t){t.path=t.path.split("/").splice(1).join("/"),R&&(t.path.startsWith(R+"/")?t.path=t.path.slice(R.length):t.path="")}}),Ye(`Extracted to ${S} in ${Date.now()-_}ms`),l.install&&(Ye("Installing dependencies..."),await Pe({cwd:S,silent:l.silent})),{...b,source:m,dir:S}}export{si as downloadTemplate,ei as registryProvider};
