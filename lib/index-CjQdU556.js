import{Buffer as e}from"node:buffer";import t from"node:path";import n,{ChildProcess as r}from"node:child_process";import o from"node:process";import{c as i,g as s}from"./index.js";import a from"child_process";import c from"path";import d from"fs";import{fileURLToPath as u}from"node:url";import l,{constants as p}from"node:os";import{createWriteStream as f,readFileSync as m,createReadStream as h}from"node:fs";import{setTimeout as g}from"node:timers/promises";import y from"stream";import{debuglog as b}from"node:util";import"os";import"crypto";import"http";import"https";import"net";import"tls";import"events";import"assert";import"util";import"buffer";import"querystring";import"stream/web";import"node:stream";import"node:events";import"worker_threads";import"perf_hooks";import"util/types";import"async_hooks";import"console";import"url";import"zlib";import"string_decoder";import"diagnostics_channel";import"timers";import"node:fs/promises";import"module";import"vm";import"process";import"v8";import"tty";import"node:module";import"node:assert";import"node:v8";var w,x,v,S,E,T,I,C,P={exports:{}};function O(){if(x)return w;x=1,w=n,n.sync=function(n,r){return t(e.statSync(n),n,r)};var e=d;function t(e,t,n){return!(!e.isSymbolicLink()&&!e.isFile())&&function(e,t){var n=void 0!==t.pathExt?t.pathExt:process.env.PATHEXT;if(!n)return!0;if(-1!==(n=n.split(";")).indexOf(""))return!0;for(var r=0;r<n.length;r++){var o=n[r].toLowerCase();if(o&&e.substr(-o.length).toLowerCase()===o)return!0}return!1}(t,n)}function n(n,r,o){e.stat(n,(function(e,i){o(e,!e&&t(i,n,r))}))}return w}function A(){if(S)return v;S=1,v=t,t.sync=function(t,r){return n(e.statSync(t),r)};var e=d;function t(t,r,o){e.stat(t,(function(e,t){o(e,!e&&n(t,r))}))}function n(e,t){return e.isFile()&&function(e,t){var n=e.mode,r=e.uid,o=e.gid,i=void 0!==t.uid?t.uid:process.getuid&&process.getuid(),s=void 0!==t.gid?t.gid:process.getgid&&process.getgid(),a=parseInt("100",8),c=parseInt("010",8),d=parseInt("001",8),u=a|c;return n&d||n&c&&o===s||n&a&&r===i||n&u&&0===i}(e,t)}return v}function G(){if(C)return I;C=1;const e="win32"===process.platform||"cygwin"===process.env.OSTYPE||"msys"===process.env.OSTYPE,t=c,n=e?";":":",r=function(){if(T)return E;var e;function t(n,r,o){if("function"==typeof r&&(o=r,r={}),!o){if("function"!=typeof Promise)throw new TypeError("callback not provided");return new Promise((function(e,o){t(n,r||{},(function(t,n){t?o(t):e(n)}))}))}e(n,r||{},(function(e,t){e&&("EACCES"===e.code||r&&r.ignoreErrors)&&(e=null,t=!1),o(e,t)}))}return T=1,e="win32"===process.platform||i.TESTING_WINDOWS?O():A(),E=t,t.sync=function(t,n){try{return e.sync(t,n||{})}catch(e){if(n&&n.ignoreErrors||"EACCES"===e.code)return!1;throw e}},E}(),o=e=>Object.assign(new Error(`not found: ${e}`),{code:"ENOENT"}),s=(t,r)=>{const o=r.colon||n,i=t.match(/\//)||e&&t.match(/\\/)?[""]:[...e?[process.cwd()]:[],...(r.path||process.env.PATH||"").split(o)],s=e?r.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",a=e?s.split(o):[""];return e&&-1!==t.indexOf(".")&&""!==a[0]&&a.unshift(""),{pathEnv:i,pathExt:a,pathExtExe:s}},a=(e,n,i)=>{"function"==typeof n&&(i=n,n={}),n||(n={});const{pathEnv:a,pathExt:c,pathExtExe:d}=s(e,n),u=[],l=r=>new Promise(((i,s)=>{if(r===a.length)return n.all&&u.length?i(u):s(o(e));const c=a[r],d=/^".*"$/.test(c)?c.slice(1,-1):c,l=t.join(d,e),f=!d&&/^\.[\\\/]/.test(e)?e.slice(0,2)+l:l;i(p(f,r,0))})),p=(e,t,o)=>new Promise(((i,s)=>{if(o===c.length)return i(l(t+1));const a=c[o];r(e+a,{pathExt:d},((r,s)=>{if(!r&&s){if(!n.all)return i(e+a);u.push(e+a)}return i(p(e,t,o+1))}))}));return i?l(0).then((e=>i(null,e)),i):l(0)};return I=a,a.sync=(e,n)=>{n=n||{};const{pathEnv:i,pathExt:a,pathExtExe:c}=s(e,n),d=[];for(let o=0;o<i.length;o++){const s=i[o],u=/^".*"$/.test(s)?s.slice(1,-1):s,l=t.join(u,e),p=!u&&/^\.[\\\/]/.test(e)?e.slice(0,2)+l:l;for(let e=0;e<a.length;e++){const t=p+a[e];try{if(r.sync(t,{pathExt:c})){if(!n.all)return t;d.push(t)}}catch(e){}}}if(n.all&&d.length)return d;if(n.nothrow)return null;throw o(e)},I}var k,$,j,B={exports:{}};function L(){if(j)return $;j=1;const e=c,t=G(),n=function(){if(k)return B.exports;k=1;const e=(e={})=>{const t=e.env||process.env;return"win32"!==(e.platform||process.platform)?"PATH":Object.keys(t).reverse().find((e=>"PATH"===e.toUpperCase()))||"Path"};return B.exports=e,B.exports.default=e,B.exports}();function r(r,o){const i=r.options.env||process.env,s=process.cwd(),a=null!=r.options.cwd,c=a&&void 0!==process.chdir&&!process.chdir.disabled;if(c)try{process.chdir(r.options.cwd)}catch(e){}let d;try{d=t.sync(r.command,{path:i[n({env:i})],pathExt:o?e.delimiter:void 0})}catch(e){}finally{c&&process.chdir(s)}return d&&(d=e.resolve(a?r.options.cwd:"",d)),d}return $=function(e){return r(e)||r(e,!0)}}var R,N,U,_,D,F,M,z,H,W,K,V,X={};function Y(){return U?N:(U=1,N=/^#!(.*)/)}function q(){if(D)return _;D=1;const e=Y();return _=(t="")=>{const n=t.match(e);if(!n)return null;const[r,o]=n[0].replace(/#! ?/,"").split(" "),i=r.split("/").pop();return"env"===i?o:o?`${i} ${o}`:i},_}function Z(){if(H)return z;H=1;const e=c,t=L(),n=function(){if(R)return X;R=1;const e=/([()\][%!^"`<>&|;, *?])/g;return X.command=function(t){return t.replace(e,"^$1")},X.argument=function(t,n){return t=(t=`"${t=(t=(t=`${t}`).replace(/(?=(\\+?)?)\1"/g,'$1$1\\"')).replace(/(?=(\\+?)?)\1$/,"$1$1")}"`).replace(e,"^$1"),n&&(t=t.replace(e,"^$1")),t},X}(),r=function(){if(M)return F;M=1;const e=d,t=q();return F=function(n){const r=Buffer.alloc(150);let o;try{o=e.openSync(n,"r"),e.readSync(o,r,0,150,0),e.closeSync(o)}catch(e){}return t(r.toString())}}(),o="win32"===process.platform,i=/\.(?:com|exe)$/i,s=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function a(a){if(!o)return a;const c=function(e){e.file=t(e);const n=e.file&&r(e.file);return n?(e.args.unshift(e.file),e.command=n,t(e)):e.file}(a),d=!i.test(c);if(a.options.forceShell||d){const t=s.test(c);a.command=e.normalize(a.command),a.command=n.command(a.command),a.args=a.args.map((e=>n.argument(e,t)));const r=[a.command].concat(a.args).join(" ");a.args=["/d","/s","/c",`"${r}"`],a.command=process.env.comspec||"cmd.exe",a.options.windowsVerbatimArguments=!0}return a}return z=function(e,t,n){t&&!Array.isArray(t)&&(n=t,t=null);const r={command:e,args:t=t?t.slice(0):[],options:n=Object.assign({},n),file:void 0,original:{command:e,args:t}};return n.shell?r:a(r)}}function Q(){if(K)return W;K=1;const e="win32"===process.platform;function t(e,t){return Object.assign(new Error(`${t} ${e.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${t} ${e.command}`,path:e.command,spawnargs:e.args})}function n(n,r){return e&&1===n&&!r.file?t(r.original,"spawn"):null}return W={hookChildProcess:function(t,r){if(!e)return;const o=t.emit;t.emit=function(e,i){if("exit"===e){const e=n(i,r);if(e)return o.call(t,"error",e)}return o.apply(t,arguments)}},verifyENOENT:n,verifyENOENTSync:function(n,r){return e&&1===n&&!r.file?t(r.original,"spawnSync"):null},notFoundError:t},W}var J=function(){if(V)return P.exports;V=1;const e=a,t=Z(),n=Q();function r(r,o,i){const s=t(r,o,i),a=e.spawn(s.command,s.args,s.options);return n.hookChildProcess(a,s),a}return P.exports=r,P.exports.spawn=r,P.exports.sync=function(r,o,i){const s=t(r,o,i),a=e.spawnSync(s.command,s.args,s.options);return a.error=a.error||n.verifyENOENTSync(a.status,s),a},P.exports._parse=t,P.exports._enoent=n,P.exports}(),ee=s(J);function te(e={}){const{env:t=process.env,platform:n=process.platform}=e;return"win32"!==n?"PATH":Object.keys(t).reverse().find((e=>"PATH"===e.toUpperCase()))||"Path"}const ne=(e,n)=>{let r;for(;r!==n;)e.push(t.join(n,"node_modules/.bin")),r=n,n=t.resolve(n,"..")},re=(e,n,r)=>{const o=n instanceof URL?u(n):n;e.push(t.resolve(r,o,".."))},oe=({env:e=o.env,...n}={})=>{const r=te({env:e={...e}});return n.path=e[r],e[r]=(({cwd:e=o.cwd(),path:n=o.env[te()],preferLocal:r=!0,execPath:i=o.execPath,addExecPath:s=!0}={})=>{const a=e instanceof URL?u(e):e,c=t.resolve(a),d=[];return r&&ne(d,c),s&&re(d,i,c),[...d,n].join(t.delimiter)})(n),e},ie=(e,t,n,r)=>{if("length"===n||"prototype"===n)return;if("arguments"===n||"caller"===n)return;const o=Object.getOwnPropertyDescriptor(e,n),i=Object.getOwnPropertyDescriptor(t,n);!se(o,i)&&r||Object.defineProperty(e,n,i)},se=function(e,t){return void 0===e||e.configurable||e.writable===t.writable&&e.enumerable===t.enumerable&&e.configurable===t.configurable&&(e.writable||e.value===t.value)},ae=(e,t)=>`/* Wrapped ${e}*/\n${t}`,ce=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),de=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name");function ue(e,t,{ignoreNonConfigurable:n=!1}={}){const{name:r}=e;for(const r of Reflect.ownKeys(t))ie(e,t,r,n);return((e,t)=>{const n=Object.getPrototypeOf(t);n!==Object.getPrototypeOf(e)&&Object.setPrototypeOf(e,n)})(e,t),((e,t,n)=>{const r=""===n?"":`with ${n.trim()}() `,o=ae.bind(null,r,t.toString());Object.defineProperty(o,"name",de),Object.defineProperty(e,"toString",{...ce,value:o})})(e,t,r),e}const le=new WeakMap,pe=(e,t={})=>{if("function"!=typeof e)throw new TypeError("Expected a function");let n,r=0;const o=e.displayName||e.name||"<anonymous>",i=function(...s){if(le.set(i,++r),1===r)n=e.apply(this,s),e=null;else if(!0===t.throw)throw new Error(`Function \`${o}\` can only be called once`);return n};return ue(i,e),le.set(i,r),i};pe.callCount=e=>{if(!le.has(e))throw new Error(`The given function \`${e.name}\` is not wrapped by the \`onetime\` package`);return le.get(e)};const fe=(e,t)=>({name:`SIGRT${t+1}`,number:me+t,action:"terminate",description:"Application-specific signal (realtime)",standard:"posix"}),me=34,he=64,ge=[{name:"SIGHUP",number:1,action:"terminate",description:"Terminal closed",standard:"posix"},{name:"SIGINT",number:2,action:"terminate",description:"User interruption with CTRL-C",standard:"ansi"},{name:"SIGQUIT",number:3,action:"core",description:"User interruption with CTRL-\\",standard:"posix"},{name:"SIGILL",number:4,action:"core",description:"Invalid machine instruction",standard:"ansi"},{name:"SIGTRAP",number:5,action:"core",description:"Debugger breakpoint",standard:"posix"},{name:"SIGABRT",number:6,action:"core",description:"Aborted",standard:"ansi"},{name:"SIGIOT",number:6,action:"core",description:"Aborted",standard:"bsd"},{name:"SIGBUS",number:7,action:"core",description:"Bus error due to misaligned, non-existing address or paging error",standard:"bsd"},{name:"SIGEMT",number:7,action:"terminate",description:"Command should be emulated but is not implemented",standard:"other"},{name:"SIGFPE",number:8,action:"core",description:"Floating point arithmetic error",standard:"ansi"},{name:"SIGKILL",number:9,action:"terminate",description:"Forced termination",standard:"posix",forced:!0},{name:"SIGUSR1",number:10,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGSEGV",number:11,action:"core",description:"Segmentation fault",standard:"ansi"},{name:"SIGUSR2",number:12,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGPIPE",number:13,action:"terminate",description:"Broken pipe or socket",standard:"posix"},{name:"SIGALRM",number:14,action:"terminate",description:"Timeout or timer",standard:"posix"},{name:"SIGTERM",number:15,action:"terminate",description:"Termination",standard:"ansi"},{name:"SIGSTKFLT",number:16,action:"terminate",description:"Stack is empty or overflowed",standard:"other"},{name:"SIGCHLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"posix"},{name:"SIGCLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"other"},{name:"SIGCONT",number:18,action:"unpause",description:"Unpaused",standard:"posix",forced:!0},{name:"SIGSTOP",number:19,action:"pause",description:"Paused",standard:"posix",forced:!0},{name:"SIGTSTP",number:20,action:"pause",description:'Paused using CTRL-Z or "suspend"',standard:"posix"},{name:"SIGTTIN",number:21,action:"pause",description:"Background process cannot read terminal input",standard:"posix"},{name:"SIGBREAK",number:21,action:"terminate",description:"User interruption with CTRL-BREAK",standard:"other"},{name:"SIGTTOU",number:22,action:"pause",description:"Background process cannot write to terminal output",standard:"posix"},{name:"SIGURG",number:23,action:"ignore",description:"Socket received out-of-band data",standard:"bsd"},{name:"SIGXCPU",number:24,action:"core",description:"Process timed out",standard:"bsd"},{name:"SIGXFSZ",number:25,action:"core",description:"File too big",standard:"bsd"},{name:"SIGVTALRM",number:26,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGPROF",number:27,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGWINCH",number:28,action:"ignore",description:"Terminal window size changed",standard:"bsd"},{name:"SIGIO",number:29,action:"terminate",description:"I/O is available",standard:"other"},{name:"SIGPOLL",number:29,action:"terminate",description:"Watched event",standard:"other"},{name:"SIGINFO",number:29,action:"ignore",description:"Request for process information",standard:"other"},{name:"SIGPWR",number:30,action:"terminate",description:"Device running out of power",standard:"systemv"},{name:"SIGSYS",number:31,action:"core",description:"Invalid system call",standard:"other"},{name:"SIGUNUSED",number:31,action:"terminate",description:"Invalid system call",standard:"other"}],ye=()=>{const e=(()=>{const e=he-me+1;return Array.from({length:e},fe)})();return[...ge,...e].map(be)},be=({name:e,number:t,description:n,action:r,forced:o=!1,standard:i})=>{const{signals:{[e]:s}}=p,a=void 0!==s;return{name:e,number:a?s:t,description:n,supported:a,action:r,forced:o,standard:i}},we=({name:e,number:t,description:n,supported:r,action:o,forced:i,standard:s})=>[e,{name:e,number:t,description:n,supported:r,action:o,forced:i,standard:s}],xe=(()=>{const e=ye();return Object.fromEntries(e.map(we))})(),ve=(e,t)=>{const n=Se(e,t);if(void 0===n)return{};const{name:r,description:o,supported:i,action:s,forced:a,standard:c}=n;return{[e]:{name:r,number:e,description:o,supported:i,action:s,forced:a,standard:c}}},Se=(e,t)=>{const n=t.find((({name:t})=>p.signals[t]===e));return void 0!==n?n:t.find((t=>t.number===e))};(()=>{const e=ye(),t=he+1,n=Array.from({length:t},((t,n)=>ve(n,e)));Object.assign({},...n)})();const Ee=({stdout:e,stderr:t,all:n,error:r,signal:i,exitCode:s,command:a,escapedCommand:c,timedOut:d,isCanceled:u,killed:l,parsed:{options:{timeout:p,cwd:f=o.cwd()}}})=>{s=null===s?void 0:s;const m=void 0===(i=null===i?void 0:i)?void 0:xe[i].description,h=(({timedOut:e,timeout:t,errorCode:n,signal:r,signalDescription:o,exitCode:i,isCanceled:s})=>e?`timed out after ${t} milliseconds`:s?"was canceled":void 0!==n?`failed with ${n}`:void 0!==r?`was killed with ${r} (${o})`:void 0!==i?`failed with exit code ${i}`:"failed")({timedOut:d,timeout:p,errorCode:r&&r.code,signal:i,signalDescription:m,exitCode:s,isCanceled:u}),g=`Command ${h}: ${a}`,y="[object Error]"===Object.prototype.toString.call(r),b=y?`${g}\n${r.message}`:g,w=[b,t,e].filter(Boolean).join("\n");return y?(r.originalMessage=r.message,r.message=w):r=new Error(w),r.shortMessage=b,r.command=a,r.escapedCommand=c,r.exitCode=s,r.signal=i,r.signalDescription=m,r.stdout=e,r.stderr=t,r.cwd=f,void 0!==n&&(r.all=n),"bufferedData"in r&&delete r.bufferedData,r.failed=!0,r.timedOut=Boolean(d),r.isCanceled=u,r.killed=l&&!d,r},Te=["stdin","stdout","stderr"],Ie=e=>{if(!e)return;const{stdio:t}=e;if(void 0===t)return Te.map((t=>e[t]));if((e=>Te.some((t=>void 0!==e[t])))(e))throw new Error(`It's not possible to provide \`stdio\` in combination with one of ${Te.map((e=>`\`${e}\``)).join(", ")}`);if("string"==typeof t)return t;if(!Array.isArray(t))throw new TypeError(`Expected \`stdio\` to be of type \`string\` or \`Array\`, got \`${typeof t}\``);const n=Math.max(t.length,Te.length);return Array.from({length:n},((e,n)=>t[n]))},Ce=[];Ce.push("SIGHUP","SIGINT","SIGTERM"),"win32"!==process.platform&&Ce.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),"linux"===process.platform&&Ce.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT");const Pe=e=>!!e&&"object"==typeof e&&"function"==typeof e.removeListener&&"function"==typeof e.emit&&"function"==typeof e.reallyExit&&"function"==typeof e.listeners&&"function"==typeof e.kill&&"number"==typeof e.pid&&"function"==typeof e.on,Oe=Symbol.for("signal-exit emitter"),Ae=globalThis,Ge=Object.defineProperty.bind(Object);class ke{emitted={afterExit:!1,exit:!1};listeners={afterExit:[],exit:[]};count=0;id=Math.random();constructor(){if(Ae[Oe])return Ae[Oe];Ge(Ae,Oe,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(e,t){this.listeners[e].push(t)}removeListener(e,t){const n=this.listeners[e],r=n.indexOf(t);-1!==r&&(0===r&&1===n.length?n.length=0:n.splice(r,1))}emit(e,t,n){if(this.emitted[e])return!1;this.emitted[e]=!0;let r=!1;for(const o of this.listeners[e])r=!0===o(t,n)||r;return"exit"===e&&(r=this.emit("afterExit",t,n)||r),r}}class $e{}const je=globalThis.process,{onExit:Be,load:Le,unload:Re}=(Ne=Pe(je)?new class extends $e{#e="win32"===je.platform?"SIGINT":"SIGHUP";#t=new ke;#n;#r;#o;#i={};#s=!1;constructor(e){super(),this.#n=e,this.#i={};for(const t of Ce)this.#i[t]=()=>{const n=this.#n.listeners(t);let{count:r}=this.#t;const o=e;if("object"==typeof o.__signal_exit_emitter__&&"number"==typeof o.__signal_exit_emitter__.count&&(r+=o.__signal_exit_emitter__.count),n.length===r){this.unload();const n=this.#t.emit("exit",null,t),r="SIGHUP"===t?this.#e:t;n||e.kill(e.pid,r)}};this.#o=e.reallyExit,this.#r=e.emit}onExit(e,t){if(!Pe(this.#n))return()=>{};!1===this.#s&&this.load();const n=t?.alwaysLast?"afterExit":"exit";return this.#t.on(n,e),()=>{this.#t.removeListener(n,e),0===this.#t.listeners.exit.length&&0===this.#t.listeners.afterExit.length&&this.unload()}}load(){if(!this.#s){this.#s=!0,this.#t.count+=1;for(const e of Ce)try{const t=this.#i[e];t&&this.#n.on(e,t)}catch(e){}this.#n.emit=(e,...t)=>this.#a(e,...t),this.#n.reallyExit=e=>this.#c(e)}}unload(){this.#s&&(this.#s=!1,Ce.forEach((e=>{const t=this.#i[e];if(!t)throw new Error("Listener not defined for signal: "+e);try{this.#n.removeListener(e,t)}catch(e){}})),this.#n.emit=this.#r,this.#n.reallyExit=this.#o,this.#t.count-=1)}#c(e){return Pe(this.#n)?(this.#n.exitCode=e||0,this.#t.emit("exit",this.#n.exitCode,null),this.#o.call(this.#n,this.#n.exitCode)):0}#a(e,...t){const n=this.#r;if("exit"===e&&Pe(this.#n)){"number"==typeof t[0]&&(this.#n.exitCode=t[0]);const r=n.call(this.#n,e,...t);return this.#t.emit("exit",this.#n.exitCode,null),r}return n.call(this.#n,e,...t)}}(je):new class extends $e{onExit(){return()=>{}}load(){}unload(){}},{onExit:(e,t)=>Ne.onExit(e,t),load:()=>Ne.load(),unload:()=>Ne.unload()});var Ne;const Ue=(e,t="SIGTERM",n={})=>{const r=e(t);return _e(e,t,n,r),r},_e=(e,t,n,r)=>{if(!De(t,n,r))return;const o=Me(n),i=setTimeout((()=>{e("SIGKILL")}),o);i.unref&&i.unref()},De=(e,{forceKillAfterTimeout:t},n)=>Fe(e)&&!1!==t&&n,Fe=e=>e===l.constants.signals.SIGTERM||"string"==typeof e&&"SIGTERM"===e.toUpperCase(),Me=({forceKillAfterTimeout:e=!0})=>{if(!0===e)return 5e3;if(!Number.isFinite(e)||e<0)throw new TypeError(`Expected the \`forceKillAfterTimeout\` option to be a non-negative integer, got \`${e}\` (${typeof e})`);return e},ze=(e,t)=>{e.kill()&&(t.isCanceled=!0)},He=(e,{timeout:t,killSignal:n="SIGTERM"},r)=>{if(0===t||void 0===t)return r;let o;const i=new Promise(((r,i)=>{o=setTimeout((()=>{((e,t,n)=>{e.kill(t),n(Object.assign(new Error("Timed out"),{timedOut:!0,signal:t}))})(e,n,i)}),t)})),s=r.finally((()=>{clearTimeout(o)}));return Promise.race([i,s])};function We(e){return null!==e&&"object"==typeof e&&"function"==typeof e.pipe}function Ke(e){return We(e)&&!1!==e.writable&&"function"==typeof e._write&&"object"==typeof e._writableState}const Ve=(e,t,n)=>{if("string"==typeof n)return e[t].pipe(f(n)),e;if(Ke(n))return e[t].pipe(n),e;if(!(e=>e instanceof r&&"function"==typeof e.then)(n))throw new TypeError("The second argument must be a string, a stream or an Execa child process.");if(!Ke(n.stdin))throw new TypeError("The target child process's stdin must be available.");return e[t].pipe(n.stdin),n},Xe=async(e,{init:t,convertChunk:n,getSize:r,truncateChunk:o,addChunk:i,getFinalChunk:s,finalize:a},{maxBuffer:c=Number.POSITIVE_INFINITY}={})=>{if(!Qe(e))throw new Error("The first argument must be a Readable, a ReadableStream, or an async iterable.");const d=t();d.length=0;try{for await(const t of e){const e=n[Je(t)](t,d);qe({convertedChunk:e,state:d,getSize:r,truncateChunk:o,addChunk:i,maxBuffer:c})}return Ye({state:d,convertChunk:n,getSize:r,truncateChunk:o,addChunk:i,getFinalChunk:s,maxBuffer:c}),a(d)}catch(e){throw e.bufferedData=a(d),e}},Ye=({state:e,getSize:t,truncateChunk:n,addChunk:r,getFinalChunk:o,maxBuffer:i})=>{const s=o(e);void 0!==s&&qe({convertedChunk:s,state:e,getSize:t,truncateChunk:n,addChunk:r,maxBuffer:i})},qe=({convertedChunk:e,state:t,getSize:n,truncateChunk:r,addChunk:o,maxBuffer:i})=>{const s=n(e),a=t.length+s;if(a<=i)return void Ze(e,t,o,a);const c=r(e,i-t.length);throw void 0!==c&&Ze(c,t,o,i),new tt},Ze=(e,t,n,r)=>{t.contents=n(e,t,r),t.length=r},Qe=e=>"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator],Je=e=>{const t=typeof e;if("string"===t)return"string";if("object"!==t||null===e)return"others";if(globalThis.Buffer?.isBuffer(e))return"buffer";const n=et.call(e);return"[object ArrayBuffer]"===n?"arrayBuffer":"[object DataView]"===n?"dataView":Number.isInteger(e.byteLength)&&Number.isInteger(e.byteOffset)&&"[object ArrayBuffer]"===et.call(e.buffer)?"typedArray":"others"},{toString:et}=Object.prototype;class tt extends Error{name="MaxBufferError";constructor(){super("maxBuffer exceeded")}}const nt=e=>{throw new Error(`Streams in object mode are not supported: ${String(e)}`)},rt=e=>e.length;const ot=new TextEncoder,it=e=>new Uint8Array(e),st=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength),at=(e,t)=>{if(t<=e.byteLength)return e;const n=new ArrayBuffer(dt(t));return new Uint8Array(n).set(new Uint8Array(e),0),n},ct=(e,t)=>{if(t<=e.maxByteLength)return e.resize(t),e;const n=new ArrayBuffer(t,{maxByteLength:dt(t)});return new Uint8Array(n).set(new Uint8Array(e),0),n},dt=e=>ut**Math.ceil(Math.log(e)/Math.log(ut)),ut=2,lt=()=>"resize"in ArrayBuffer.prototype,pt={init:()=>({contents:new ArrayBuffer(0)}),convertChunk:{string:e=>ot.encode(e),buffer:it,arrayBuffer:it,dataView:st,typedArray:st,others:nt},getSize:rt,truncateChunk:(e,t)=>e.slice(0,t),addChunk:(e,{contents:t,length:n},r)=>{const o=lt()?ct(t,r):at(t,r);return new Uint8Array(o).set(e,n),o},getFinalChunk:()=>{},finalize:({contents:e,length:t})=>lt()?e:e.slice(0,t)};async function ft(e,t){if(!("Buffer"in globalThis))throw new Error("getStreamAsBuffer() is only supported in Node.js");try{return mt(await async function(e,t){return Xe(e,pt,t)}(e,t))}catch(e){throw void 0!==e.bufferedData&&(e.bufferedData=mt(e.bufferedData)),e}}const mt=e=>globalThis.Buffer.from(e);const ht=(e,{textDecoder:t})=>t.decode(e,{stream:!0}),gt={init:()=>({contents:"",textDecoder:new TextDecoder}),convertChunk:{string:e=>e,buffer:ht,arrayBuffer:ht,dataView:ht,typedArray:ht,others:nt},getSize:rt,truncateChunk:(e,t)=>e.slice(0,t),addChunk:(e,{contents:t})=>t+e,getFinalChunk:({textDecoder:e})=>{const t=e.decode();return""===t?void 0:t},finalize:({contents:e})=>e};var yt,bt;var wt=s(function(){if(bt)return yt;bt=1;const{PassThrough:e}=y;return yt=function(){var t=[],n=new e({objectMode:!0});return n.setMaxListeners(0),n.add=r,n.isEmpty=function(){return 0==t.length},n.on("unpipe",o),Array.prototype.slice.call(arguments).forEach(r),n;function r(e){return Array.isArray(e)?(e.forEach(r),this):(t.push(e),e.once("end",o.bind(null,e)),e.once("error",n.emit.bind(n,"error")),e.pipe(n,{end:!1}),this)}function o(e){!(t=t.filter((function(t){return t!==e}))).length&&n.readable&&n.end()}}}());const xt=e=>{if(void 0!==e)throw new TypeError("The `input` and `inputFile` options cannot be both set.")},vt=e=>{const t=(({input:e,inputFile:t})=>"string"!=typeof t?e:(xt(e),m(t)))(e);if(We(t))throw new TypeError("The `input` option cannot be a stream in sync mode");return t},St=(e,t)=>{const n=(({input:e,inputFile:t})=>"string"!=typeof t?e:(xt(e),h(t)))(t);void 0!==n&&(We(n)?n.pipe(e.stdin):e.stdin.end(n))},Et=async(e,t)=>{if(e&&void 0!==t){await g(0),e.destroy();try{return await t}catch(e){return e.bufferedData}}},Tt=(e,{encoding:t,buffer:n,maxBuffer:r})=>{if(e&&n)return"utf8"===t||"utf-8"===t?async function(e,t){return Xe(e,gt,t)}(e,{maxBuffer:r}):null===t||"buffer"===t?ft(e,{maxBuffer:r}):It(e,r,t)},It=async(e,t,n)=>(await ft(e,{maxBuffer:t})).toString(n),Ct=(async()=>{})().constructor.prototype,Pt=["then","catch","finally"].map((e=>[e,Reflect.getOwnPropertyDescriptor(Ct,e)])),Ot=(e,t)=>{for(const[n,r]of Pt){const o="function"==typeof t?(...e)=>Reflect.apply(r.value,t(),e):r.value.bind(t);Reflect.defineProperty(e,n,{...r,value:o})}},At=(e,t=[])=>Array.isArray(t)?[e,...t]:[e],Gt=/^[\w.-]+$/,kt=(e,t)=>At(e,t).join(" "),$t=(e,t)=>At(e,t).map((e=>(e=>"string"!=typeof e||Gt.test(e)?e:`"${e.replaceAll('"','\\"')}"`)(e))).join(" "),jt=/ +/g,Bt=e=>{const t=[];for(const n of e.trim().split(jt)){const e=t.at(-1);e&&e.endsWith("\\")?t[t.length-1]=`${e.slice(0,-1)} ${n}`:t.push(n)}return t},Lt=t=>{const n=typeof t;if("string"===n)return t;if("number"===n)return String(t);if("object"===n&&null!==t&&!(t instanceof r)&&"stdout"in t){const n=typeof t.stdout;if("string"===n)return t.stdout;if(e.isBuffer(t.stdout))return t.stdout.toString();throw new TypeError(`Unexpected "${n}" stdout in template expression`)}throw new TypeError(`Unexpected "${n}" in template expression`)},Rt=(e,t,n)=>n||0===e.length||0===t.length?[...e,...t]:[...e.slice(0,-1),`${e.at(-1)}${t[0]}`,...t.slice(1)],Nt=({templates:e,expressions:t,tokens:n,index:r,template:o})=>{const i=o??e.raw[r],s=i.split(jt).filter(Boolean),a=Rt(n,s,i.startsWith(" "));if(r===t.length)return a;const c=t[r],d=Array.isArray(c)?c.map((e=>Lt(e))):[Lt(c)];return Rt(a,d,i.endsWith(" "))},Ut=(e,t)=>{let n=[];for(const[r,o]of e.entries())n=Nt({templates:e,expressions:t,tokens:n,index:r,template:o});return n},_t=b("execa").enabled,Dt=(e,t)=>String(e).padStart(t,"0"),Ft=(e,{verbose:t})=>{t&&o.stderr.write(`[${(()=>{const e=new Date;return`${Dt(e.getHours(),2)}:${Dt(e.getMinutes(),2)}:${Dt(e.getSeconds(),2)}.${Dt(e.getMilliseconds(),3)}`})()}] ${e}\n`)},Mt=(e,n,r={})=>{const i=ee._parse(e,n,r);return e=i.command,n=i.args,(r={maxBuffer:1e8,buffer:!0,stripFinalNewline:!0,extendEnv:!0,preferLocal:!1,localDir:(r=i.options).cwd||o.cwd(),execPath:o.execPath,encoding:"utf8",reject:!0,cleanup:!0,all:!1,windowsHide:!0,verbose:_t,...r}).env=(({env:e,extendEnv:t,preferLocal:n,localDir:r,execPath:i})=>{const s=t?{...o.env,...e}:e;return n?oe({env:s,cwd:r,execPath:i}):s})(r),r.stdio=Ie(r),"win32"===o.platform&&"cmd"===t.basename(e,".exe")&&n.unshift("/q"),{file:e,args:n,options:r,parsed:i}},zt=(t,n,r)=>"string"==typeof n||e.isBuffer(n)?t.stripFinalNewline?function(e){const t="string"==typeof e?"\n":"\n".charCodeAt(),n="string"==typeof e?"\r":"\r".charCodeAt();return e[e.length-1]===t&&(e=e.slice(0,-1)),e[e.length-1]===n&&(e=e.slice(0,-1)),e}(n):n:void 0===r?void 0:"";function Ht(e,t,r){const o=Mt(e,t,r),i=kt(e,t),s=$t(e,t);let a;Ft(s,o.options),(({timeout:e})=>{if(void 0!==e&&(!Number.isFinite(e)||e<0))throw new TypeError(`Expected the \`timeout\` option to be a non-negative integer, got \`${e}\` (${typeof e})`)})(o.options);try{a=n.spawn(o.file,o.args,o.options)}catch(e){const t=new n.ChildProcess,r=Promise.reject(Ee({error:e,stdout:"",stderr:"",all:"",command:i,escapedCommand:s,parsed:o,timedOut:!1,isCanceled:!1,killed:!1}));return Ot(t,r),t}const c=(e=>new Promise(((t,n)=>{e.on("exit",((e,n)=>{t({exitCode:e,signal:n})})),e.on("error",(e=>{n(e)})),e.stdin&&e.stdin.on("error",(e=>{n(e)}))})))(a),d=He(a,o.options,c),u=(async(e,{cleanup:t,detached:n},r)=>{if(!t||n)return r;const o=Be((()=>{e.kill()}));return r.finally((()=>{o()}))})(a,o.options,d);a.kill=Ue.bind(null,a.kill.bind(a)),a.cancel=ze.bind(null,a,{isCanceled:!1});const l=pe((async()=>{const[{error:e,exitCode:t,signal:n,timedOut:r},c,d,l]=await(async({stdout:e,stderr:t,all:n},{encoding:r,buffer:o,maxBuffer:i},s)=>{const a=Tt(e,{encoding:r,buffer:o,maxBuffer:i}),c=Tt(t,{encoding:r,buffer:o,maxBuffer:i}),d=Tt(n,{encoding:r,buffer:o,maxBuffer:2*i});try{return await Promise.all([s,a,c,d])}catch(r){return Promise.all([{error:r,signal:r.signal,timedOut:r.timedOut},Et(e,a),Et(t,c),Et(n,d)])}})(a,o.options,u),p=zt(o.options,c),f=zt(o.options,d),m=zt(o.options,l);if(e||0!==t||null!==n){const c=Ee({error:e,exitCode:t,signal:n,stdout:p,stderr:f,all:m,command:i,escapedCommand:s,parsed:o,timedOut:r,isCanceled:!!o.options.signal&&o.options.signal.aborted,killed:a.killed});if(!o.options.reject)return c;throw c}return{command:i,escapedCommand:s,exitCode:0,stdout:p,stderr:f,all:m,failed:!1,timedOut:!1,isCanceled:!1,killed:!1}}));return St(a,o.options),a.all=((e,{all:t})=>{if(!t||!e.stdout&&!e.stderr)return;const n=wt();return e.stdout&&n.add(e.stdout),e.stderr&&n.add(e.stderr),n})(a,o.options),(e=>{null!==e.stdout&&(e.pipeStdout=Ve.bind(void 0,e,"stdout")),null!==e.stderr&&(e.pipeStderr=Ve.bind(void 0,e,"stderr")),void 0!==e.all&&(e.pipeAll=Ve.bind(void 0,e,"all"))})(a),Ot(a,l),a}function Wt(e,t,r){const o=Mt(e,t,r),i=kt(e,t),s=$t(e,t);Ft(s,o.options);const a=vt(o.options);let c;try{c=n.spawnSync(o.file,o.args,{...o.options,input:a})}catch(e){throw Ee({error:e,stdout:"",stderr:"",all:"",command:i,escapedCommand:s,parsed:o,timedOut:!1,isCanceled:!1,killed:!1})}const d=zt(o.options,c.stdout,c.error),u=zt(o.options,c.stderr,c.error);if(c.error||0!==c.status||null!==c.signal){const e=Ee({stdout:d,stderr:u,error:c.error,signal:c.signal,exitCode:c.status,command:i,escapedCommand:s,parsed:o,timedOut:c.error&&"ETIMEDOUT"===c.error.code,isCanceled:!1,killed:null!==c.signal});if(!o.options.reject)return e;throw e}return{command:i,escapedCommand:s,exitCode:0,stdout:d,stderr:u,failed:!1,timedOut:!1,isCanceled:!1,killed:!1}}const Kt=({input:e,inputFile:t,stdio:n})=>void 0===e&&void 0===t&&void 0===n?{stdin:"inherit"}:{},Vt=(e={})=>({preferLocal:!0,...Kt(e),...e});const Xt=function e(t){function n(n,...r){if(!Array.isArray(n))return e({...t,...n});const[o,...i]=Ut(n,r);return Ht(o,i,Vt(t))}return n.sync=(e,...n)=>{if(!Array.isArray(e))throw new TypeError("Please use $(options).sync`command` instead of $.sync(options)`command`.");const[r,...o]=Ut(e,n);return Wt(r,o,Vt(t))},n}();function Yt(e,t){const[n,...r]=Bt(e);return Ht(n,r,t)}function qt(e,t){const[n,...r]=Bt(e);return Wt(n,r,t)}function Zt(e,t,n={}){t&&!Array.isArray(t)&&"object"==typeof t&&(n=t,t=[]);const r=(e=>{const t=Ie(e);return"ipc"===t?"ipc":void 0===t||"string"==typeof t?[t,t,t,"ipc"]:t.includes("ipc")?t:[...t,"ipc"]})(n),i=o.execArgv.filter((e=>!e.startsWith("--inspect"))),{nodePath:s=o.execPath,nodeOptions:a=i}=n;return Ht(s,[...a,e,...Array.isArray(t)?t:[]],{...n,stdin:void 0,stdout:void 0,stderr:void 0,stdio:r,shell:!1})}export{Xt as $,Ht as execa,Yt as execaCommand,qt as execaCommandSync,Zt as execaNode,Wt as execaSync};
